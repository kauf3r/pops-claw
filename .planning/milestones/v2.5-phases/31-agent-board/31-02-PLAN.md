---
phase: 31-agent-board
plan: 02
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - src/components/agents/agent-card.tsx
  - src/app/agents/page.tsx
autonomous: false
requirements: [AGNT-01, AGNT-02, AGNT-03, AGNT-04]

must_haves:
  truths:
    - "Visiting /agents shows a card for each of the 7 agents"
    - "Each card has a colored left border (green=active, amber=stale, rose=down)"
    - "Each card shows agent name, system subtitle, status label, relative timestamp with hover tooltip"
    - "Each card shows 24h token count and model breakdown line"
    - "Each card shows error badge (gray=0, red=non-zero)"
    - "Page header shows fleet summary (N active . N stale . N down)"
    - "Cards are sorted: down first, stale second, active last"
    - "Grid is 4 columns on desktop, 2 on tablet, 1 on mobile"
  artifacts:
    - path: "src/components/agents/agent-card.tsx"
      provides: "AgentCard component with status border, tokens, errors"
      contains: "AgentCard"
    - path: "src/app/agents/page.tsx"
      provides: "Agent board page with grid layout and fleet summary"
      contains: "useSWR"
  key_links:
    - from: "src/app/agents/page.tsx"
      to: "/api/agents"
      via: "useSWR('/api/agents')"
      pattern: "useSWR.*api/agents"
    - from: "src/app/agents/page.tsx"
      to: "src/components/agents/agent-card.tsx"
      via: "import AgentCard"
      pattern: "AgentCard"
    - from: "src/components/agents/agent-card.tsx"
      to: "src/lib/utils.ts"
      via: "import formatTokens, formatModelBreakdown"
      pattern: "formatTokens|formatModelBreakdown"
---

<objective>
Build the agent board UI: agent card component and /agents page with responsive grid, fleet summary header, and SWR data fetching.

Purpose: Give Andy a dedicated view of all 7 agents' health, token usage, and errors at a glance -- problems surface to the top via status-priority sorting.
Output: Working /agents page accessible via NavBar, auto-refreshing every 30s.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-agent-board/31-CONTEXT.md
@.planning/phases/31-agent-board/31-RESEARCH.md
@.planning/phases/31-agent-board/31-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AgentCard component and /agents page</name>
  <files>
    src/components/agents/agent-card.tsx
    src/app/agents/page.tsx
  </files>
  <action>
**Create src/components/agents/agent-card.tsx** ("use client"):

Props: `{ agent: AgentBoardData }` (import type from `@/lib/queries/agents`)

Layout per card (all info visible, no expand/collapse):
1. **Left border accent** -- thick (border-l-4) colored by status:
   - active: `border-l-emerald-500`
   - stale: `border-l-amber-500`
   - down: `border-l-rose-500`
2. **Agent name** -- prominent (text-base font-semibold), system as subtitle below (text-xs text-muted-foreground)
3. **Status row** -- flex between status label (colored text: "Active"/"Stale"/"Down") and last-seen timestamp
   - Use existing `RelativeTime` component from `@/components/dashboard/relative-time` for relative time
   - Wrap RelativeTime in a `<span title={absoluteTimestamp}>` for hover tooltip (native title attr, per research recommendation to avoid shadcn Tooltip dependency)
   - If lastSeen is null, show "Never seen" text instead of RelativeTime
4. **Token usage** -- total as "12.4k tokens" (text-sm font-medium), model breakdown line below as "H: 8k . S: 3k" (text-xs text-muted-foreground)
   - Import `formatTokens` and `formatModelBreakdown` from `@/lib/utils`
   - If total is 0, show "0 tokens" with no breakdown line
5. **Error badge** -- use shadcn Badge component
   - `variant="destructive"` when errors24h > 0
   - `variant="secondary"` when errors24h === 0
   - Text: "N errors" (or "1 error" for singular)

Card styling: Use shadcn Card + CardContent. Subtle bordered, rounded corners. Dark zinc background matches existing dashboard theme. Padding p-4, space-y-3 between sections.

**Create src/app/agents/page.tsx** ("use client"):

1. **SWR fetch** -- `useSWR('/api/agents')` using the global SWR config (30s polling already configured in providers.tsx). Type the response as AgentBoardSummary.

2. **Page header:**
   - Title: "Agents" (text-2xl font-bold)
   - Subtitle: fleet summary from API response -- "N active . N stale . N down" with colored numbers (emerald for active count, amber for stale, rose for down). Use middle dot separator.
   - Below subtitle: "Last 24 hours" label (text-xs text-muted-foreground) so it's not repeated per card

3. **Loading state:** Show skeleton/placeholder cards (or a simple "Loading agents..." text) while SWR is fetching

4. **Card grid:** Responsive CSS grid
   - `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`
   - Maps over `data.agents` rendering `<AgentCard agent={agent} key={agent.id} />`

5. **Freshness indicator:** Import and use FreshnessIndicator from `@/components/dashboard/freshness-indicator` (same as dashboard page) to show last-refresh time
  </action>
  <verify>
SSH to EC2, ensure dev server is running, then:
1. `curl -s http://localhost:3001/agents` -- confirm HTML response (page renders server-side)
2. Visit http://100.72.143.9:3001/agents from Tailscale device -- visually confirm 7 cards in grid layout
3. Confirm cards are sorted (down/stale agents appear first)
4. Confirm left border colors match status
5. Confirm token numbers are reasonable (hundreds of k, not millions)
  </verify>
  <done>
/agents page renders 7 agent cards in a responsive grid. Each card shows status with colored left border, name/system, relative timestamp with hover tooltip, 24h token count with model breakdown, and error badge. Page header shows fleet summary. Data auto-refreshes via SWR polling.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify agent board from Tailscale device</name>
  <files>n/a</files>
  <action>
Human verification of the complete agent board. Claude presents the page URL and verification steps. User visits and confirms visual/functional correctness.

What was built: Agent board page at /agents with 7 agent cards showing heartbeat status, token usage, model distribution, and error counts. NavBar updated with Agents link. Data auto-refreshes every 30 seconds.
  </action>
  <verify>
User performs these checks:
1. Visit http://100.72.143.9:3001/agents from any Tailscale device
2. Confirm page header shows "Agents" title with fleet summary (e.g., "3 active . 2 stale . 2 down")
3. Confirm 7 cards are displayed in a grid (4 columns on desktop)
4. Confirm cards are sorted: down/stale agents appear at the top
5. Confirm each card shows: agent name, system subtitle, status label + colored left border, relative timestamp
6. Hover over a timestamp -- should show absolute date/time in tooltip
7. Confirm token usage shows compact format (e.g., "458.1k tokens") with model breakdown below
8. Confirm error badges are gray for 0 errors, red for non-zero
9. Click "Agents" in NavBar -- confirms navigation works
10. Wait 30+ seconds -- data should auto-refresh (freshness indicator resets)
  </verify>
  <done>User types "approved" confirming all 10 verification steps pass, or describes issues to fix.</done>
</task>

</tasks>

<verification>
1. /agents page loads and shows 7 agent cards
2. Cards have Linear-style colored left borders matching status
3. Fleet summary header accurately counts active/stale/down agents
4. Token counts display in compact format with model breakdown
5. Error badges are visually distinct (gray vs red)
6. Sort order is Down > Stale > Active > alphabetical
7. NavBar has working Agents link
8. Data auto-refreshes every 30 seconds
</verification>

<success_criteria>
- All 4 AGNT requirements are satisfied on the live /agents page
- User can see agent health, tokens, and errors at a glance
- Problems (down/stale agents) surface to the top
- Page matches locked design decisions from CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/31-agent-board/31-02-SUMMARY.md`
</output>
