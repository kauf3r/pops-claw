---
phase: 16-wordpress-publishing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - "~/.openclaw/openclaw.json (EC2)"
autonomous: false
user_setup:
  - service: wordpress
    why: "Publishing approved articles to WordPress"
    env_vars:
      - name: WP_SITE_URL
        source: "Your WordPress site URL (e.g. https://example.com)"
      - name: WP_USERNAME
        source: "WordPress admin username"
      - name: WP_APP_PASSWORD
        source: "WordPress Admin -> Users -> Your Profile -> Application Passwords -> generate new"
    dashboard_config:
      - task: "Generate Application Password"
        location: "WordPress Admin -> Users -> Your Profile -> Application Passwords section -> enter name 'openclaw' -> Add New Application Password -> copy the generated password"

must_haves:
  truths:
    - "WP_SITE_URL, WP_USERNAME, WP_APP_PASSWORD are available in agent sandbox environment"
    - "WordPress REST API responds to authenticated requests from sandbox"
  artifacts:
    - path: "~/.openclaw/openclaw.json (EC2)"
      provides: "WP credentials in agents.defaults.sandbox.docker.env"
      contains: "WP_SITE_URL"
  key_links:
    - from: "openclaw.json sandbox.docker.env"
      to: "WordPress REST API"
      via: "curl with Basic auth (WP_USERNAME:WP_APP_PASSWORD)"
      pattern: "WP_SITE_URL.*WP_USERNAME.*WP_APP_PASSWORD"
---

<objective>
Configure WordPress API credentials for Ezra's publishing workflow.

Purpose: Ezra needs authenticated access to the WordPress REST API to create draft posts from approved articles in content.db.
Output: WP credentials injected into sandbox environment, verified with a test API call.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Generate WordPress Application Password</name>
  <action>
    User must generate a WordPress Application Password:
    1. Log into WordPress admin dashboard
    2. Go to Users -> Your Profile
    3. Scroll to "Application Passwords" section
    4. Enter name: "openclaw"
    5. Click "Add New Application Password"
    6. Copy the generated password (it will only be shown once)
    7. Provide the following three values:
       - WordPress site URL (e.g. https://yoursite.com)
       - WordPress username
       - The application password you just generated
  </action>
  <resume-signal>Provide: WP_SITE_URL, WP_USERNAME, and WP_APP_PASSWORD values</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Add WP credentials to sandbox environment and verify API access</name>
  <files>~/.openclaw/openclaw.json (EC2)</files>
  <action>
    SSH to EC2 (100.72.143.9) and add WordPress credentials to openclaw.json:

    1. Add three env vars to `agents.defaults.sandbox.docker.env` in ~/.openclaw/openclaw.json:
       - `WP_SITE_URL`: The WordPress site URL provided by user (no trailing slash)
       - `WP_USERNAME`: The WordPress username provided by user
       - `WP_APP_PASSWORD`: The application password provided by user
       Use jq to add these without disturbing existing env vars (OURA_ACCESS_TOKEN, GITHUB_TOKEN, GOVEE_API_KEY).

    2. Restart gateway service: `systemctl --user restart openclaw-gateway.service`

    3. Verify gateway is active: `systemctl --user status openclaw-gateway.service`

    4. Smoke-test WordPress REST API from EC2:
       ```
       curl -s -u "$WP_USERNAME:$WP_APP_PASSWORD" "$WP_SITE_URL/wp-json/wp/v2/posts?per_page=1&status=draft" | head -c 500
       ```
       Expected: JSON array (even if empty `[]`), NOT a 401 or 403 error.

    5. Also test categories endpoint:
       ```
       curl -s "$WP_SITE_URL/wp-json/wp/v2/categories" | head -c 500
       ```
       Expected: JSON array of existing categories.

    NOTE: Do NOT hardcode credentials in any file that gets committed. They only exist in openclaw.json on EC2.
  </action>
  <verify>
    - `ssh ... jq '.agents.defaults.sandbox.docker.env | keys' ~/.openclaw/openclaw.json` includes WP_SITE_URL, WP_USERNAME, WP_APP_PASSWORD
    - Gateway service is active
    - curl to WP REST API /wp-json/wp/v2/posts returns 200 (not 401/403)
    - curl to WP REST API /wp-json/wp/v2/categories returns JSON array
  </verify>
  <done>WordPress API credentials are in sandbox env, gateway restarted, and authenticated API calls succeed from EC2</done>
</task>

</tasks>

<verification>
- openclaw.json has WP_SITE_URL, WP_USERNAME, WP_APP_PASSWORD in sandbox env
- Gateway service is active after restart
- WordPress REST API responds to authenticated requests (200, not 401)
- Categories endpoint returns valid JSON
</verification>

<success_criteria>
WordPress REST API is accessible from the EC2 instance using the configured credentials. All three WP env vars are present in the sandbox environment configuration.
</success_criteria>

<output>
After completion, create `.planning/phases/16-wordpress-publishing/16-01-SUMMARY.md`
</output>
