---
phase: 29-infrastructure-database-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/clawd/mission-control/package.json
  - ~/clawd/mission-control/src/app/providers.tsx
  - ~/clawd/mission-control/src/components/dashboard/activity-feed.tsx
  - ~/clawd/mission-control/src/components/dashboard/global-search.tsx
  - ~/clawd/mission-control/tsconfig.json
  - ~/clawd/mission-control/src/app/globals.css
  - ~/clawd/mission-control/components.json
  - ~/clawd/mission-control/src/components/dashboard/relative-time.tsx
autonomous: true
requirements:
  - INFRA-04
  - INFRA-05
  - INFRA-06

must_haves:
  truths:
    - "No Convex imports exist anywhere in the codebase (grep returns zero results)"
    - "npm ls convex returns 'empty' or 'not found' (package fully uninstalled)"
    - "shadcn table and chart components exist in src/components/ui/"
    - "components.json baseColor is 'zinc' (not 'slate')"
    - "CSS variables in globals.css .dark block use zinc neutral palette with blue primary accents"
    - "RelativeTime component renders relative timestamps client-side without hydration mismatch"
    - "swr package is installed and importable"
  artifacts:
    - path: "src/components/ui/table.tsx"
      provides: "shadcn Table component"
    - path: "src/components/ui/chart.tsx"
      provides: "shadcn Chart component (Recharts wrapper)"
    - path: "src/components/dashboard/relative-time.tsx"
      provides: "Hydration-safe relative timestamp component"
    - path: "src/app/providers.tsx"
      provides: "Clean provider wrapper with no Convex imports"
  key_links:
    - from: "src/components/dashboard/relative-time.tsx"
      to: "date-fns"
      via: "formatDistanceToNow import"
      pattern: "formatDistanceToNow"
    - from: "src/app/providers.tsx"
      to: "children"
      via: "passthrough render"
      pattern: "children"
---

<objective>
Remove Convex dependency, install missing packages (SWR, shadcn table/chart), configure zinc+blue dark-mode palette, and create the RelativeTime component.

Purpose: Clean the codebase of external Convex dependency, set up the component and styling foundation that Plan 02's landing page and all future phases will build on.
Output: A Convex-free codebase with SWR installed, shadcn table+chart components available, zinc+blue CSS variables active, and a reusable RelativeTime component.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-infrastructure-database-foundation/29-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Convex and install SWR</name>
  <files>
    ~/clawd/mission-control/package.json
    ~/clawd/mission-control/tsconfig.json
    ~/clawd/mission-control/.env.local
    ~/clawd/mission-control/.env.example
    ~/clawd/mission-control/convex/ (delete entire directory)
    ~/clawd/mission-control/convex.json (delete)
    ~/clawd/mission-control/src/app/providers.tsx
    ~/clawd/mission-control/src/components/dashboard/activity-feed.tsx
    ~/clawd/mission-control/src/components/dashboard/global-search.tsx
  </files>
  <action>
    SSH to EC2 (100.72.143.9) and perform Convex removal in ~/clawd/mission-control/:

    1. **Delete Convex directory and config:**
       - `rm -rf convex/` (contains schema.ts, activities.ts, _generated/)
       - `rm -f convex.json`

    2. **Uninstall Convex + install SWR:**
       - `npm uninstall convex`
       - `npm install swr`
       - `rm -rf node_modules/.cache`

    3. **Clean environment files:**
       - Remove `CONVEX_DEPLOYMENT`, `NEXT_PUBLIC_CONVEX_URL`, `NEXT_PUBLIC_CONVEX_SITE_URL` from `.env.local`
       - Remove `NEXT_PUBLIC_CONVEX_URL=` from `.env.example`

    4. **Clean tsconfig.json:**
       - Remove the `"@convex/*": ["convex/*"]` entry from `compilerOptions.paths`
       - If `paths` is now empty, remove the `paths` key entirely

    5. **Rewrite providers.tsx** -- remove ConvexProvider, replace with simple passthrough:
       ```typescript
       // src/app/providers.tsx
       // Convex removed in Phase 29. Simple passthrough for now.
       // Can add SWRConfig here later for global SWR options.

       export function Providers({ children }: { children: React.ReactNode }) {
         return <>{children}</>;
       }
       ```

    6. **Stub activity-feed.tsx** -- remove Convex useQuery, replace with placeholder:
       ```typescript
       // Convex removed. Will be reimplemented with SWR + SQLite API in Phase 30.
       export function ActivityFeed() {
         return (
           <div className="text-muted-foreground text-sm p-4 text-center">
             Activity feed coming in Phase 30
           </div>
         );
       }
       ```

    7. **Stub global-search.tsx** -- remove Convex useQuery, replace with placeholder:
       ```typescript
       // Convex removed. Will be reimplemented with SWR + SQLite API in Phase 30.
       export function GlobalSearch() {
         return null;
       }
       ```

    8. **Verify no Convex references remain:**
       - `grep -r "convex" src/ --include="*.ts" --include="*.tsx" -l` should return 0 files
       - `grep -r "@convex" src/ --include="*.ts" --include="*.tsx" -l` should return 0 files
  </action>
  <verify>
    - `cd ~/clawd/mission-control && npm ls convex 2>&1` shows "empty" or "not found"
    - `npm ls swr` shows swr installed
    - `grep -r "convex" src/ --include="*.ts" --include="*.tsx" -l` returns nothing
    - `ls convex/ 2>&1` shows "No such file or directory"
    - `cat convex.json 2>&1` shows "No such file or directory"
  </verify>
  <done>Convex fully removed (no imports, no package, no config, no directory). SWR installed. Providers.tsx is a clean passthrough. Activity-feed and global-search are stubbed.</done>
</task>

<task type="auto">
  <name>Task 2: Install shadcn table/chart, update zinc palette, create RelativeTime</name>
  <files>
    ~/clawd/mission-control/components.json
    ~/clawd/mission-control/src/components/ui/table.tsx
    ~/clawd/mission-control/src/components/ui/chart.tsx
    ~/clawd/mission-control/src/app/globals.css
    ~/clawd/mission-control/src/components/dashboard/relative-time.tsx
  </files>
  <action>
    SSH to EC2 (100.72.143.9) and work in ~/clawd/mission-control/:

    1. **Update components.json baseColor:**
       - Change `"baseColor": "slate"` to `"baseColor": "zinc"` in components.json
       - This ensures future `npx shadcn@latest add` commands generate zinc-based CSS

    2. **Install missing shadcn components:**
       - `npx shadcn@latest add table chart --yes`
       - This creates `src/components/ui/table.tsx` and `src/components/ui/chart.tsx`
       - Chart component installs recharts as a dependency (needed for Phase 32 VIZ-*)

    3. **Update globals.css dark mode CSS variables for zinc + blue accents:**
       Find the `.dark` block in globals.css and replace its CSS variables with:
       ```css
       .dark {
         --background: 240 10% 3.9%;
         --foreground: 0 0% 98%;
         --card: 240 10% 3.9%;
         --card-foreground: 0 0% 98%;
         --popover: 240 10% 3.9%;
         --popover-foreground: 0 0% 98%;
         --primary: 217.2 91.2% 59.8%;
         --primary-foreground: 222.2 47.4% 11.2%;
         --secondary: 240 3.7% 15.9%;
         --secondary-foreground: 0 0% 98%;
         --muted: 240 3.7% 15.9%;
         --muted-foreground: 240 5% 64.9%;
         --accent: 240 3.7% 15.9%;
         --accent-foreground: 0 0% 98%;
         --destructive: 0 62.8% 30.6%;
         --destructive-foreground: 0 0% 98%;
         --border: 240 3.7% 15.9%;
         --input: 240 3.7% 15.9%;
         --ring: 217.2 91.2% 59.8%;
       }
       ```
       The key changes: primary and ring are blue (217.2 91.2% 59.8%), neutrals are zinc-based (240 hue).

    4. **Create RelativeTime component:**
       Create `src/components/dashboard/relative-time.tsx`:
       ```typescript
       "use client";

       import { useEffect, useState } from "react";
       import { formatDistanceToNow } from "date-fns";

       interface RelativeTimeProps {
         date: string | Date;
         className?: string;
       }

       export function RelativeTime({ date, className }: RelativeTimeProps) {
         const [relative, setRelative] = useState<string | null>(null);

         useEffect(() => {
           const d = typeof date === "string" ? new Date(date) : date;
           setRelative(formatDistanceToNow(d, { addSuffix: true }));

           const interval = setInterval(() => {
             setRelative(formatDistanceToNow(d, { addSuffix: true }));
           }, 60_000);

           return () => clearInterval(interval);
         }, [date]);

         if (!relative) {
           // Server-side / pre-hydration fallback: render nothing to avoid mismatch
           return <span className={className} suppressHydrationWarning />;
         }

         return <span className={className}>{relative}</span>;
       }
       ```
       Key design choices:
       - `"use client"` directive -- this MUST be a client component (uses useState/useEffect)
       - Server renders empty `<span>` (not a date string) to guarantee no hydration mismatch
       - Client replaces with relative time after mount via useEffect
       - Auto-refreshes every 60 seconds
       - Uses date-fns `formatDistanceToNow` (already installed, per research)
  </action>
  <verify>
    - `ls src/components/ui/table.tsx src/components/ui/chart.tsx` both exist
    - `cat components.json | grep baseColor` shows "zinc"
    - `grep "217.2 91.2% 59.8%" src/app/globals.css` returns matches (blue primary)
    - `cat src/components/dashboard/relative-time.tsx` shows the component with "use client" and formatDistanceToNow
    - `npm ls recharts` shows recharts installed (brought in by chart component)
  </verify>
  <done>shadcn table and chart components installed. components.json baseColor is zinc. globals.css .dark block uses zinc neutrals with blue primary/ring accents. RelativeTime component created with hydration-safe pattern (empty server render, client-side formatDistanceToNow).</done>
</task>

</tasks>

<verification>
1. `cd ~/clawd/mission-control && grep -r "convex" src/ --include="*.ts" --include="*.tsx" -l` returns nothing
2. `npm ls convex 2>&1` shows not found
3. `npm ls swr recharts` shows both installed
4. `ls src/components/ui/{table,chart}.tsx` both exist
5. `cat components.json | grep baseColor` shows zinc
6. `cat src/components/dashboard/relative-time.tsx` exists with "use client" + formatDistanceToNow
7. `cat src/app/providers.tsx` has no Convex imports
</verification>

<success_criteria>
- Zero Convex references in the codebase (imports, packages, config, directory)
- SWR and recharts packages installed
- shadcn table and chart components present in src/components/ui/
- CSS variables use zinc palette with blue primary accents
- RelativeTime component renders timestamps without hydration mismatch
- providers.tsx is a clean passthrough wrapper
</success_criteria>

<output>
After completion, create `.planning/phases/29-infrastructure-database-foundation/29-01-SUMMARY.md`
</output>
