---
phase: 17-social-promotion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - "~/.openclaw/skills/social-promoter/SKILL.md (EC2)"
  - "~/clawd/agents/ezra/PUBLISH_SESSION.md (EC2)"
autonomous: true

must_haves:
  truths:
    - "Ezra can generate social media copy for 3 platforms (LinkedIn, X/Twitter, Instagram) from a published article"
    - "Social copy is stored in social_posts table in content.db with correct article_id and platform"
    - "Ezra generates social posts automatically after confirming an article was published on WordPress"
    - "Ezra posts a summary to #content-pipeline listing the social copy generated"
    - "Human can retrieve social copy from content.db to manually post on each platform"
  artifacts:
    - path: "~/.openclaw/skills/social-promoter/SKILL.md (EC2)"
      provides: "Social media copy generation skill for 3 platforms"
      contains: "social-promoter"
    - path: "~/clawd/agents/ezra/PUBLISH_SESSION.md (EC2)"
      provides: "Updated publish session with social promotion step after publication confirmation"
      contains: "social-promoter"
  key_links:
    - from: "SKILL.md social-promoter"
      to: "content.db articles table"
      via: "sqlite3 SELECT WHERE status='published'"
      pattern: "status.*published"
    - from: "SKILL.md social-promoter"
      to: "content.db social_posts table"
      via: "sqlite3 INSERT INTO social_posts"
      pattern: "INSERT INTO social_posts"
    - from: "PUBLISH_SESSION.md"
      to: "social-promoter skill"
      via: "Step added to generate social posts after confirming publication"
      pattern: "social-promoter"
---

<objective>
Deploy Ezra's social-promoter skill and integrate social copy generation into the existing publish-check workflow.

Purpose: After a human publishes an article on WordPress, Ezra generates platform-specific social media copy (LinkedIn, X/Twitter, Instagram) and stores it in content.db for human manual posting. No API integrations â€” content generation only.
Output: social-promoter SKILL.md, updated PUBLISH_SESSION.md with social promotion step.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-wordpress-publishing/16-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy social-promoter SKILL.md for Ezra</name>
  <files>~/.openclaw/skills/social-promoter/SKILL.md (EC2)</files>
  <action>
    SSH to EC2 (100.72.143.9) and create the social-promoter skill.

    Create directory: `mkdir -p ~/.openclaw/skills/social-promoter/`

    Write `~/.openclaw/skills/social-promoter/SKILL.md` with this structure:

    **Frontmatter (required for OpenClaw detection):**
    ```yaml
    ---
    name: social-promoter
    description: Generate platform-specific social media copy for published articles
    ---
    ```

    **Section 1: Overview**
    - You generate social media copy for articles that have been published on WordPress
    - You create posts for 3 platforms: LinkedIn, X/Twitter, and Instagram
    - All generated copy is stored in the social_posts table in content.db
    - You do NOT post to any social platform â€” a human copies the content and posts manually
    - Your job is to craft compelling, platform-appropriate copy that drives traffic to the article

    **Section 2: Find Published Articles Needing Social Posts**
    - Query for published articles that don't yet have social posts:
      ```sql
      SELECT a.id, a.title, a.slug, a.body, a.word_count, a.wp_url,
             a.published_at, t.category, t.keywords
      FROM articles a
      JOIN topics t ON a.topic_id = t.id
      WHERE a.status = 'published'
        AND a.id NOT IN (
          SELECT DISTINCT article_id FROM social_posts
        )
      ORDER BY a.published_at DESC;
      ```
    - If no results: no social posts needed, end silently

    **Section 3: Generate LinkedIn Post**
    - Target: Professional audience, UAS/drone industry professionals
    - Format: 1300 chars max (LinkedIn feed limit), no hashtag spam
    - Structure:
      - Hook line (attention-grabbing first sentence that appears before "...see more")
      - 2-3 paragraphs of insight/value from the article
      - Call to action with article link
      - 3-5 relevant hashtags at the end (e.g., #UAS #DroneServices #Aviation)
    - Tone: Professional, authoritative, thought-leadership
    - MUST include the wp_url as the article link
    - Store with platform='linkedin'

    **Section 4: Generate X/Twitter Post**
    - Target: Broad tech/aviation/drone audience
    - Format: Single tweet (280 chars) OR thread (2-4 tweets, each â‰¤280 chars)
    - For single tweet: Hook + link + 1-2 hashtags
    - For thread: First tweet is the hook with "ðŸ§µ" indicator, subsequent tweets expand key points, last tweet has the article link
    - Store the full content (thread delimiter: "---" between tweets)
    - Tone: Conversational, punchy, curiosity-driving
    - MUST include the wp_url in the last tweet (or only tweet)
    - Store with platform='twitter'

    **Section 5: Generate Instagram Caption**
    - Target: Visual-first audience interested in drone/UAS content
    - Format: Up to 2200 chars, front-load the hook (first 125 chars visible before "...more")
    - Structure:
      - Hook line (first 125 chars critical)
      - 2-3 short paragraphs with line breaks
      - Call to action: "Link in bio" (Instagram doesn't allow clickable links in captions)
      - 15-25 hashtags grouped at the end (mix of broad + niche: #drones #UAS #droneservices #aviation #dronetech etc.)
    - Also generate an `image_prompt` field: a DALL-E/Midjourney style prompt describing an ideal image to accompany the post (e.g., "Aerial photograph of a commercial drone inspecting a cell tower at sunset, professional photography, 4K")
    - Tone: Engaging, accessible, visual-descriptive
    - Store with platform='instagram'

    **Section 6: Store Social Posts in content.db**
    - For each platform, insert into social_posts:
      ```sql
      BEGIN IMMEDIATE;
      INSERT INTO social_posts (article_id, platform, content, image_prompt, status, created_at)
      VALUES ({ARTICLE_ID}, '{platform}', '{content}', '{image_prompt_or_null}', 'draft', datetime('now'));

      INSERT INTO pipeline_activity (entity_type, entity_id, action, agent_id, details)
      VALUES ('social_post', last_insert_rowid(), 'created', 'ezra',
              'Generated {platform} post for article {ARTICLE_ID}');
      COMMIT;
      ```
    - image_prompt is NULL for LinkedIn and Twitter, populated for Instagram only
    - Escape single quotes in content by doubling them (SQL standard)
    - Use /workspace/content.db for all database operations (sandbox path)

    **Section 7: Notify #content-pipeline**
    - After generating all 3 platform posts for an article, post to #content-pipeline:
      ```
      :mega: **Social Media Copy Ready**

      **Article:** {article title}
      **URL:** {wp_url}

      Generated copy for:
      - LinkedIn (1 post)
      - X/Twitter (1 post/thread)
      - Instagram (1 caption + image prompt)

      Copy is stored in content.db social_posts table. Retrieve with:
      `SELECT platform, content FROM social_posts WHERE article_id = {ID};`
      ```

    **Section 8: Retrieve Social Copy (for human reference)**
    - To retrieve all social copy for an article:
      ```sql
      SELECT platform, content, image_prompt, status, created_at
      FROM social_posts
      WHERE article_id = {ARTICLE_ID}
      ORDER BY platform;
      ```
    - To retrieve all pending social posts across articles:
      ```sql
      SELECT sp.id, a.title, sp.platform, sp.content, sp.image_prompt
      FROM social_posts sp
      JOIN articles a ON sp.article_id = a.id
      WHERE sp.status = 'draft'
      ORDER BY sp.created_at;
      ```
    - After human manually posts to a platform, update status:
      ```sql
      UPDATE social_posts
      SET status = 'posted', posted_at = datetime('now'), post_url = '{ACTUAL_POST_URL}'
      WHERE id = {SOCIAL_POST_ID};
      ```

    **Section 9: Error Handling**
    - If article body is too short (<200 words): skip social generation, note in #content-pipeline
    - If INSERT fails: log error, do NOT retry in same session, report in #content-pipeline
    - If article already has social_posts entries: skip (idempotent check in Section 2 query)

    **Important notes in skill:**
    - This skill generates COPY ONLY â€” no API posting to any social platform
    - Human retrieves content from content.db and posts manually
    - Always include the wp_url in LinkedIn and Twitter posts
    - Instagram uses "link in bio" pattern (no clickable links in captions)
    - curl and sqlite3 are pre-approved in exec-approvals allowlist
  </action>
  <verify>
    - `ssh ... cat ~/.openclaw/skills/social-promoter/SKILL.md` shows valid YAML frontmatter + all 9 sections
    - Skill contains SQL queries for social_posts table with correct column names
    - Skill generates copy for 3 platforms: linkedin, twitter, instagram
    - Skill includes image_prompt generation for Instagram
    - Skill includes pipeline_activity logging
    - Skill includes #content-pipeline notification template
    - Skill explicitly states NO API posting â€” content generation only
  </verify>
  <done>social-promoter SKILL.md deployed to ~/.openclaw/skills/social-promoter/ with 3-platform social copy generation (LinkedIn, X/Twitter, Instagram), content.db storage, and Slack notifications</done>
</task>

<task type="auto">
  <name>Task 2: Update PUBLISH_SESSION.md to trigger social promotion after publication confirmation</name>
  <files>~/clawd/agents/ezra/PUBLISH_SESSION.md (EC2)</files>
  <action>
    SSH to EC2 (100.72.143.9) and update Ezra's PUBLISH_SESSION.md.

    Read the current PUBLISH_SESSION.md first. It has 5 steps. Add a Step 6 after the existing Step 5 (session summary) â€” or more precisely, insert a new step between Step 4 (confirm published) and Step 5 (session summary), renumbering Step 5 to Step 6.

    The new Step 5 should be:

    ```markdown
    5. **Generate social media copy** for newly confirmed published articles:
       - For each article that was just confirmed as "published" (in Step 4 above):
         a. Use the social-promoter skill to generate social copy for LinkedIn, X/Twitter, and Instagram
         b. Store all 3 platform posts in the social_posts table in content.db
         c. Log each social post creation in pipeline_activity
       - If no articles were confirmed published in this session, skip this step
    ```

    Then renumber the old Step 5 (session summary) to Step 6, and update the summary template to include social posts generated:

    ```markdown
    6. **Post session summary** to #content-pipeline:
       - Number of new WP drafts created
       - Number of articles confirmed published
       - Number of social media posts generated (across all platforms)
       - Any errors encountered
    ```

    Also restart the gateway after updating the file so the new workspace content is available:
    1. Restart: `systemctl --user restart openclaw-gateway.service`
    2. Verify active: `systemctl --user status openclaw-gateway.service`

    NOTE: No new cron job needed. The existing publish-check cron (daily 2 PM PT) already triggers Ezra to run PUBLISH_SESSION.md. Social promotion happens naturally when Ezra confirms publication in Step 4 â€” she then immediately generates social copy in the new Step 5.
  </action>
  <verify>
    - `ssh ... cat ~/clawd/agents/ezra/PUBLISH_SESSION.md` shows 6 steps (not 5)
    - Step 5 mentions "social-promoter skill" and "social_posts"
    - Step 6 (formerly Step 5) includes "social media posts generated" in summary template
    - Gateway service is active after restart
  </verify>
  <done>PUBLISH_SESSION.md updated with social promotion step (Step 5) triggered after publication confirmation, session summary (Step 6) includes social post count, no new cron job needed</done>
</task>

</tasks>

<verification>
- social-promoter SKILL.md exists at ~/.openclaw/skills/social-promoter/SKILL.md with valid frontmatter
- SKILL.md generates copy for LinkedIn, X/Twitter, and Instagram (3 platforms)
- SKILL.md stores posts in social_posts table with correct schema (article_id, platform, content, image_prompt, status)
- SKILL.md does NOT post to any social platform API â€” content generation only
- PUBLISH_SESSION.md has 6 steps with social promotion integrated after publication confirmation
- Gateway service is active after restart
- No new cron job â€” social promotion piggybacks on existing publish-check cron (daily 2 PM PT)
</verification>

<success_criteria>
Ezra has a social-promoter skill that generates LinkedIn, X/Twitter, and Instagram copy for published articles. Social copy generation is integrated into the publish-check workflow â€” when Ezra confirms an article was published on WordPress, she immediately generates social posts and stores them in content.db. Human can retrieve the copy to post manually.
</success_criteria>

<output>
After completion, create `.planning/phases/17-social-promotion/17-01-SUMMARY.md`
</output>
