---
phase: 12-content-db-agent-setup
plan: 03
type: execute
wave: 2
depends_on: ["12-02"]
files_modified:
  - ~/.openclaw/openclaw.json (EC2)
autonomous: false

must_haves:
  truths:
    - "#content-pipeline Slack channel exists with bot as member"
    - "All 3 content agents (Quill, Sage, Ezra) are bound to #content-pipeline"
    - "Messages in #content-pipeline are routed to content agents"
  artifacts:
    - path: "~/.openclaw/openclaw.json"
      provides: "3 bindings mapping #content-pipeline channel ID to quill, sage, ezra agents"
      contains: "content-pipeline"
  key_links:
    - from: "Slack #content-pipeline channel"
      to: "openclaw.json bindings"
      via: "channel ID match"
      pattern: "agentId.*quill|sage|ezra"
---

<objective>
Bind the #content-pipeline Slack channel to all 3 content agents (Quill, Sage, Ezra) so they can receive messages and post updates.

Purpose: Content agents need a shared Slack channel for pipeline notifications, human approval requests, and status updates. All 3 agents share one channel (architectural decision from planning).
Output: #content-pipeline channel bound to 3 agents in openclaw.json.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-content-db-agent-setup/12-02-SUMMARY.md
@.planning/phases/07-multi-agent-slack-channels/07-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Create #content-pipeline Slack channel and invite bot</name>
  <files>N/A (human action in Slack UI)</files>
  <action>
HUMAN ACTION REQUIRED: The user must perform these steps in Slack:
1. Create a new Slack channel called `#content-pipeline` in the workspace
2. Invite the OpenClaw bot to the channel (same bot that's in #popsclaw, #land-ops, etc.)
3. Get the channel ID: open channel details in Slack, scroll to bottom, copy the Channel ID (starts with C)
4. Provide the channel ID to Claude (e.g., C0XXXXXXXXX)

Context: 3 content agents (Quill, Sage, Ezra) were registered in openclaw.json in Plan 02. This channel will be their shared communication channel.
  </action>
  <verify>User provides a valid Slack channel ID starting with "C" (typically 11 characters).</verify>
  <done>User has created #content-pipeline, invited bot, and provided the channel ID.</done>
</task>

<task type="auto">
  <name>Task 2: Bind #content-pipeline channel to all 3 content agents</name>
  <files>~/.openclaw/openclaw.json (EC2)</files>
  <action>
SSH to EC2 (100.72.143.9). Using the channel ID provided by the user in Task 1, update openclaw.json with:

1. Add 3 bindings to the `bindings` array -- one for each content agent pointing to the same channel:

```json
{ "agentId": "quill", "match": { "channel": "slack", "peer": { "kind": "channel", "id": "CHANNEL_ID_HERE" } } },
{ "agentId": "sage", "match": { "channel": "slack", "peer": { "kind": "channel", "id": "CHANNEL_ID_HERE" } } },
{ "agentId": "ezra", "match": { "channel": "slack", "peer": { "kind": "channel", "id": "CHANNEL_ID_HERE" } } }
```

Replace CHANNEL_ID_HERE with the actual channel ID from Task 1.

2. Add the channel to `channels.slack.channels`:

```json
"#content-pipeline": { "allow": true }
```

3. Restart gateway:
```bash
systemctl --user restart openclaw-gateway.service
sleep 5
systemctl --user status openclaw-gateway.service
```

4. Verify channel resolution in logs:
```bash
journalctl --user -u openclaw-gateway.service --since "5 minutes ago" --no-pager | grep -i "content-pipeline\|channels resolved"
```

The log should show `#content-pipeline->CHANNEL_ID` in the resolved channels line.

IMPORTANT: When 3 agents share one channel, OpenClaw routes messages to the first matching binding. For cron-triggered tasks targeting specific agents, the cron config uses sessionTarget + agentId directly (bypasses channel routing). For direct Slack messages in #content-pipeline, the first-match binding determines which agent responds. This is acceptable for the notification/status channel use case.
  </action>
  <verify>
SSH: `cat ~/.openclaw/openclaw.json | python3 -c "import sys,json; d=json.load(sys.stdin); binds=[b['agentId'] for b in d['bindings'] if b['match']['peer'].get('id')=='CHANNEL_ID']; print(sorted(binds))"` returns ['ezra', 'quill', 'sage'] (substitute actual channel ID).
SSH: `journalctl --user -u openclaw-gateway.service --since "5 minutes ago" --no-pager | grep "content-pipeline"` shows channel resolved.
SSH: `systemctl --user is-active openclaw-gateway.service` returns "active".
  </verify>
  <done>#content-pipeline Slack channel bound to all 3 content agents. Gateway restarted, channel resolved, and message routing active. CP-03 satisfied.</done>
</task>

</tasks>

<verification>
1. #content-pipeline channel exists in Slack with bot as member
2. openclaw.json has 3 new bindings (quill, sage, ezra) pointing to #content-pipeline channel ID
3. channels.slack.channels includes #content-pipeline with allow: true
4. Gateway logs show #content-pipeline in resolved channels
5. Gateway service active and healthy
</verification>

<success_criteria>
- #content-pipeline Slack channel created by user with bot invited
- All 3 content agents bound to the channel
- Channel allowed in slack channel config
- Gateway resolves channel on startup
- CP-03 fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/12-content-db-agent-setup/12-03-SUMMARY.md`
</output>
