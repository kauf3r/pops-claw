# Phase 31.1: Context Usage Indicators - Context

**Gathered:** 2026-02-21
**Status:** Ready for planning

<domain>
## Phase Boundary

Add context usage visibility to the existing agent board cards on /agents. Three new metrics per agent: context window utilization %, cache hit rate, and 24h cost. Uses data already tracked in observability.db — no new data collection needed.

</domain>

<decisions>
## Implementation Decisions

### Metrics
- Context window utilization % — input_tokens from most recent session vs model's max context window
- Cache hit rate — cache_read_tokens / (input_tokens + cache_read_tokens) over 24h
- 24h cost per agent — sum of estimated_cost_usd over last 24 hours

### Display location
- Extend existing AgentCard component with new "Context" section below current token counts
- No new page or dashboard section — everything at-a-glance on /agents
- Consistent with existing card layout patterns

### Visual treatment
- Context window %: compact progress bar with color thresholds (green <60%, amber 60-80%, red >80%)
- Cache hit rate: percentage text with color coding (green >50%, amber 20-50%, red <20%)
- Cost: formatted as $X.XX, plain text

### Time granularity
- 24h rolling aggregates for cache rate and cost (matches existing token/error pattern)
- Context % uses most recent session's input_tokens as "current context size"
- Per-session detail deferred to MC-04

### Claude's Discretion
- Exact progress bar height/styling within the card
- How to handle agents with zero calls in 24h (likely show dashes or "No data")
- Model max context lookup table (hardcoded constants vs config)
- Section label and spacing within the card

</decisions>

<specifics>
## Specific Ideas

- Color thresholds match existing status color language (green/amber/red already used for heartbeat status borders)
- Keep the new section compact — these are secondary metrics, not the headline
- Model context limits: Haiku 200k, Sonnet 200k, Opus 200k (all Claude 4.x family)

</specifics>

<deferred>
## Deferred Ideas

- Per-session context drill-down — MC-04 (Agent detail page)
- Token efficiency ratio (output/input) — not actionable enough for dashboard
- Time-series sparklines for context trends — VIZ phase territory

</deferred>

---

*Phase: 31.1-context-usage-indicators*
*Context gathered: 2026-02-21*
