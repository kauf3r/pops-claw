---
phase: 24-critical-security-update
plan: 02
type: execute
wave: 2
depends_on:
  - 24-01
files_modified:
  - ~/.openclaw/extensions/secureclaw/
  - ~/.openclaw/skills/secureclaw/
  - ~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md
autonomous: true
requirements:
  - SEC-02
  - SEC-03

must_haves:
  truths:
    - "SecureClaw plugin is installed and shows in openclaw plugins list"
    - "SecureClaw 51-check audit completes with zero critical failures"
    - "SecureClaw 15 behavioral rules are deployed to agent skill directory"
    - "Pre-approved workflow exceptions are documented and loaded into agent context"
    - "Gateway is still running after SecureClaw install"
    - "Bob responds to a Slack DM after restart"
    - "A test cron fires and delivers successfully"
  artifacts:
    - path: "~/.openclaw/extensions/secureclaw/"
      provides: "SecureClaw plugin installation"
    - path: "~/.openclaw/skills/secureclaw/"
      provides: "SecureClaw behavioral rules SKILL.md"
    - path: "~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md"
      provides: "Pre-approved workflow exception patterns"
  key_links:
    - from: "SecureClaw plugin"
      to: "openclaw plugins list"
      via: "plugin registry"
      pattern: "secureclaw"
    - from: "SecureClaw skill"
      to: "agent context"
      via: "skill loading"
      pattern: "secureclaw"
    - from: "SECURECLAW_EXCEPTIONS.md"
      to: "agent workspace"
      via: "bind-mount /workspace/"
      pattern: "SECURECLAW_EXCEPTIONS"
---

<objective>
Install SecureClaw security plugin, run 51-check audit, deploy 15 behavioral rules with pre-approved workflow exceptions, and smoke test the complete system (gateway, Slack DM, cron delivery).

Purpose: Add runtime behavioral security protections to Bob -- external content sandboxing, credential protection, destructive command gating -- aligned with OWASP ASI Top 10. Ensure Bob's existing 20 cron workflows aren't broken by the new security rules.

Output: SecureClaw plugin installed with passing audit, behavioral rules active with mapped exceptions, Bob responsive on Slack with working cron delivery.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-critical-security-update/24-RESEARCH.md
@.planning/phases/24-critical-security-update/24-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install SecureClaw plugin and run 51-check audit</name>
  <files>
    ~/.openclaw/extensions/secureclaw/
  </files>
  <action>
SSH to EC2 (100.72.143.9) and execute the following:

1. **Try npm install first (may not be published yet -- released Feb 16, 2026):**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw plugins install @adversa-ai/secureclaw
   ```
   If this fails (not on npm), fall back to local clone:
   ```bash
   git clone https://github.com/adversa-ai/secureclaw.git /tmp/secureclaw
   cd /tmp/secureclaw/secureclaw
   npm install
   npm run build
   /home/ubuntu/.npm-global/bin/openclaw plugins install -l .
   ```
   Note: Use `-l` flag for symlink install (easier to update later). If `-l` install fails, try without it (copies files to `~/.openclaw/extensions/secureclaw/`).

2. **Verify plugin loaded:**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw plugins list
   ```
   Must show secureclaw as loaded/enabled. If not showing:
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw plugins doctor
   ```
   Diagnose and fix any plugin loading issues.

3. **Run SecureClaw 51-check audit (READ-ONLY -- does not modify anything):**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw secureclaw audit
   ```
   Capture output. Requirement: **zero critical failures**. Warnings are OK and should be logged.

   If JSON output is available, also capture:
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw secureclaw audit --json > /tmp/secureclaw-audit-$(date +%Y%m%d).json
   ```

4. **Review audit findings carefully:**
   - **Critical findings:** Must be resolved NOW per user decision. If a critical finding requires config changes (e.g., file permissions, credential exposure), fix it before proceeding.
   - **Gateway-related findings:** SecureClaw may flag the tailnet gateway binding as non-standard. This is INTENTIONAL per project architecture. Document the finding but do NOT change the gateway binding. If the audit reports this as critical, investigate whether there's a way to acknowledge/whitelist it.
   - **Warnings:** Log them. Phase 28 handles doctor warnings. SecureClaw warnings are informational.

5. **Review SecureClaw hardening modules (DO NOT auto-apply):**
   If SecureClaw offers hardening (beyond the audit), review what each module would change BEFORE applying. Per research:
   - Gateway module: likely tries to bind to localhost -- SKIP (tailnet binding is intentional)
   - Credentials module: file perms, env isolation -- APPLY if safe
   - Config module: permission lockdown -- APPLY if safe
   - Docker module: sandbox settings -- REVIEW carefully (Bob's sandbox has specific bind-mounts)
   - Network module: firewall, listening ports -- REVIEW (UFW already configured)

   **Only apply hardening modules that do NOT conflict with existing architecture.** If hardening is all-or-nothing, skip hardening entirely and rely on audit + behavioral rules (per user's escape hatch decision).

6. **If critical findings require fixes, apply them now:**
   After fixing, re-run the audit to verify zero critical findings:
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw secureclaw audit
   ```
  </action>
  <verify>
SSH and run:
1. `/home/ubuntu/.npm-global/bin/openclaw plugins list` — must show secureclaw
2. `/home/ubuntu/.npm-global/bin/openclaw secureclaw audit` — must show zero critical failures
3. `systemctl --user status openclaw-gateway.service` — must still show active (running)
  </verify>
  <done>
SecureClaw plugin installed, 51-check audit completes with zero critical failures, any critical findings resolved, gateway still running on tailnet.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy behavioral rules with workflow exceptions and smoke test</name>
  <files>
    ~/.openclaw/skills/secureclaw/
    ~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md
  </files>
  <action>
SSH to EC2 (100.72.143.9) and execute the following:

**Part A: Deploy SecureClaw behavioral rules**

1. **Install SecureClaw skill (deploys the 15 behavioral rules):**
   ```bash
   npx openclaw secureclaw skill install
   ```
   This installs SKILL.md + supporting scripts to the agent's skill directory.

2. **Verify skill installed:**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw skills list
   ```
   Must show secureclaw skill as available/ready.

3. **Read the full SecureClaw SKILL.md to understand all 15 rules:**
   ```bash
   cat ~/.openclaw/skills/secureclaw/SKILL.md
   ```
   Map every rule against Bob's known workflows. The research identified 6 rules; the remaining 9 must be discovered and mapped now.

**Part B: Create workflow exception document**

4. **Based on the full 15-rule reading, create `~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md`:**

   This document is loaded into Bob's agent context (it's in the workspace bind-mount path) and serves as the companion exception list for SecureClaw behavioral rules.

   The document must include:
   - **Pre-approved cron workflow patterns** (all 20 crons are gated per user decision):
     - morning-briefing: reads calendar/email/health data, sends summary to Slack + email (read-then-send pattern is pre-approved for owner delivery)
     - evening-recap: same pattern as morning briefing
     - weekly-review: same pattern
     - meeting-prep-scan: reads calendar, writes MEETING_PREP.md
     - anomaly-check: reads health.db, alerts via Slack if anomaly
     - daily-standup: reads coordination.db, posts to Slack
     - monthly-expense-summary: reads receipts, sends summary
     - heartbeats (4): lightweight agent check-ins
     - topic-research, writing-check, review-check, publish-check: content pipeline crons read/write content.db
     - pipeline-report, stuck-check: monitoring crons read content.db, post to Slack
     - airspace-email-monitor: reads AirSpace Gmail, alerts on new email
     - email-catchup: polls Resend API, updates email.db
   - **Semi-trusted API sources** (per user decision): Gmail, Resend, Oura, Govee, Wyze, WordPress, gog -- already behind Tailscale + SG + Docker
   - **Full sandbox for untrusted content**: arbitrary web pages fetched via browser automation must be fully sandboxed
   - **Credential handling**: agent cannot see raw credentials (.env vars injected by gateway). Gog CLI operations that reference keyring are pre-approved.
   - **Destructive command approval**: pre-approve known cron file writes (workspace paths only). Novel destructive commands still require approval.
   - **Plan disclosure for crons**: cron jobs log their plan rather than requiring interactive approval (silent plan logging mode)

   Format as a clear reference document that Bob's agent context will load alongside SecureClaw's SKILL.md. Keep it concise -- rules are already in SKILL.md, this document only lists exceptions.

**Part C: Restart gateway and smoke test**

5. **Restart gateway to pick up new skill:**
   ```bash
   systemctl --user restart openclaw-gateway.service
   sleep 5
   systemctl --user status openclaw-gateway.service
   ```
   Must show active (running).

6. **Re-establish DM session (known requirement after gateway restart):**
   DM Bob via Slack with a test message like "Phase 24 smoke test -- are you there?"
   Bob must respond. If using CLI: try `openclaw sessions send` or equivalent to push a test message.

   If CLI DM isn't available, use the OpenClaw dashboard (SSH tunnel: `ssh -L 3000:localhost:18789 ... ubuntu@100.72.143.9` then `http://localhost:3000`) or note that the user must DM Bob manually as a checkpoint.

   **Pragmatic approach:** If there's no CLI way to initiate a DM, just verify gateway health and note that user should DM Bob. The user is running this update themselves and can easily DM.

7. **Trigger a smoke test cron:**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw cron trigger daily-heartbeat
   ```
   (If `daily-heartbeat` doesn't exist by that name, check `openclaw cron list` and trigger one of the heartbeat crons.)

   Verify it fires without errors:
   ```bash
   journalctl --user -u openclaw-gateway.service --since '2 min ago' | tail -30
   ```
   Look for successful execution, no "awaiting approval" blocks, no SecureClaw rule violations that halt the cron.

8. **Verify SecureClaw rules are active in agent context:**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw skills list | grep secureclaw
   ```
   Must show secureclaw skill as active/loaded.

9. **Capture post-SecureClaw state:**
   ```bash
   /home/ubuntu/.npm-global/bin/openclaw plugins list
   /home/ubuntu/.npm-global/bin/openclaw skills list
   /home/ubuntu/.npm-global/bin/openclaw --version
   ```
   Log all output for the summary.
  </action>
  <verify>
SSH and run:
1. `/home/ubuntu/.npm-global/bin/openclaw skills list` — must show secureclaw
2. `cat ~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md` — must exist with pre-approved patterns
3. `systemctl --user status openclaw-gateway.service` — must show active (running)
4. Check `journalctl --user -u openclaw-gateway.service --since '5 min ago' | tail -30` — no SecureClaw-related errors
5. Verify smoke test cron fired without errors
  </verify>
  <done>
SecureClaw 15 behavioral rules deployed via skill, SECURECLAW_EXCEPTIONS.md created with pre-approved workflow patterns for all 20 crons and semi-trusted API sources, gateway restarted and running, Bob responsive (or ready for user DM), smoke test cron fired without SecureClaw interference.
  </done>
</task>

</tasks>

<verification>
1. SecureClaw plugin shows in `openclaw plugins list`
2. SecureClaw 51-check audit: zero critical failures
3. SecureClaw skill shows in `openclaw skills list`
4. SECURECLAW_EXCEPTIONS.md exists in agent workspace with all 20 cron patterns pre-approved
5. Gateway running on tailnet (100.72.143.9:18789)
6. Smoke test cron fires and delivers without SecureClaw blocking
7. No "awaiting approval" or rule violation errors in gateway logs
</verification>

<success_criteria>
- SEC-02 satisfied: SecureClaw plugin installed, 51-check audit passes with zero critical failures
- SEC-03 satisfied: 15 behavioral rules active via skill, with pre-approved exceptions for Bob's workflows
- Gateway running, Bob responsive, cron delivery functional
- System ready for Phase 25 full cron/skill/agent audit
</success_criteria>

<output>
After completion, create `.planning/phases/24-critical-security-update/24-02-SUMMARY.md`
</output>
