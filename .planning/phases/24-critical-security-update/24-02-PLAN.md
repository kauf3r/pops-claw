---
phase: 24-critical-security-update
plan: 02
type: execute
wave: 2
depends_on:
  - 24-01
files_modified:
  - /home/ubuntu/.openclaw/extensions/secureclaw/
  - /home/ubuntu/.openclaw/skills/secureclaw/
  - /home/ubuntu/clawd/agents/main/SECURECLAW_EXCEPTIONS.md
autonomous: true
requirements:
  - SEC-02
  - SEC-03

must_haves:
  truths:
    - "SecureClaw plugin is installed and appears in openclaw plugins list"
    - "SecureClaw 51-check audit completes with zero critical failures"
    - "SecureClaw skill is deployed and appears in openclaw skills list"
    - "15 behavioral rules are loaded into agent context via SKILL.md"
    - "Workflow exceptions document exists in agent workspace covering known cron/email/browser patterns"
    - "Gateway is running and Bob responds to a Slack DM after all changes"
    - "A cron fires successfully with SecureClaw rules active (smoke test)"
  artifacts:
    - path: "/home/ubuntu/.openclaw/extensions/secureclaw/"
      provides: "SecureClaw plugin installation"
    - path: "/home/ubuntu/.openclaw/skills/secureclaw/"
      provides: "SecureClaw behavioral rules skill"
    - path: "/home/ubuntu/clawd/agents/main/SECURECLAW_EXCEPTIONS.md"
      provides: "Pre-approved workflow exception patterns for cron/email/browser"
  key_links:
    - from: "SecureClaw plugin"
      to: "openclaw gateway"
      via: "plugin loaded at gateway startup"
      pattern: "plugins list.*secureclaw"
    - from: "SecureClaw SKILL.md"
      to: "agent context"
      via: "skill loaded into Bob's context window"
      pattern: "skills list.*secureclaw"
    - from: "SECURECLAW_EXCEPTIONS.md"
      to: "agent behavior"
      via: "workspace document in /workspace/ (bind-mounted from ~/clawd/agents/main/)"
      pattern: "pre-approved.*patterns"
---

<objective>
Install the SecureClaw security plugin by Adversa AI, run its 51-check audit with zero critical failures, deploy the 15 behavioral rules into Bob's agent context, and configure pre-approved exceptions for known cron/email/browser workflows so nothing breaks on day one.

Purpose: Activate runtime behavioral protections (prompt injection defense, credential protection, destructive command gating) aligned with OWASP ASI Top 10, while whitelisting Bob's established automation patterns.
Output: SecureClaw plugin installed, audit clean, 15 behavioral rules active, workflow exceptions documented, Bob responsive on Slack, cron smoke test passed.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-critical-security-update/24-CONTEXT.md
@.planning/phases/24-critical-security-update/24-RESEARCH.md
@.planning/phases/24-critical-security-update/24-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install SecureClaw plugin and run 51-check security audit</name>
  <files>
    /home/ubuntu/.openclaw/extensions/secureclaw/
  </files>
  <action>
    SSH to EC2 (100.72.143.9) and install SecureClaw:

    1. **Attempt npm install first** (may not be published yet -- released Feb 16, 2026):
       - `openclaw plugins install @adversa-ai/secureclaw`
       - If this fails (package not found), fall back to local clone method

    2. **Fallback: Install from GitHub clone**:
       - `git clone https://github.com/adversa-ai/secureclaw.git /tmp/secureclaw`
       - `cd /tmp/secureclaw/secureclaw && npm install && npm run build`
       - `openclaw plugins install -l .`
       - Note: `-l` flag creates symlink. For a permanent install without symlink, omit `-l`.

    3. **Verify plugin loaded**:
       - `openclaw plugins list` -- should show secureclaw as loaded/enabled
       - If not listed: `openclaw plugins doctor` to diagnose

    4. **Run 51-check audit** (read-only, does NOT modify anything):
       - `openclaw secureclaw audit`
       - Save full output for the summary
       - Also run with JSON if available: `openclaw secureclaw audit --json > /tmp/secureclaw-audit-post-update.json`

    5. **Assess audit results**:
       - Per user decision: zero critical findings required, warnings OK and logged
       - **If critical findings exist**: fix them NOW (per user decision -- do not defer)
         - BUT: if a critical is about gateway not being on loopback (it's intentionally on tailnet), this is a false positive -- document and accept as warning
       - **Review hardening recommendations**: SecureClaw has 5 hardening modules (gateway, credentials, config, docker, network). Do NOT auto-apply gateway hardening (Pitfall 5: may rebind to localhost). Apply other hardening modules only if they don't conflict with tailnet binding or existing Docker sandbox config.

    6. **Compare with pre-update baseline**:
       - Compare SecureClaw audit findings against the pre-update security audit and ClawdStrike baseline from ~/backups/pre-v2026.2.17/
       - Note any regressions or new findings in the summary

    Note: Use full binary path `/home/ubuntu/.npm-global/bin/openclaw` for non-interactive SSH commands.
  </action>
  <verify>
    SSH: `openclaw plugins list` shows secureclaw as loaded
    SSH: `openclaw secureclaw audit` output shows 0 critical findings
    SSH: Any critical findings that appeared have been fixed or documented as false positives (e.g., tailnet gateway binding)
  </verify>
  <done>
    SecureClaw plugin is installed and operational. 51-check audit completes with zero critical failures. Any critical findings from the audit have been resolved or documented as intentional configuration (tailnet binding). Audit results saved for comparison.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy behavioral rules, configure workflow exceptions, and smoke test</name>
  <files>
    /home/ubuntu/.openclaw/skills/secureclaw/
    /home/ubuntu/clawd/agents/main/SECURECLAW_EXCEPTIONS.md
  </files>
  <action>
    SSH to EC2 (100.72.143.9) and deploy SecureClaw behavioral rules:

    1. **Install SecureClaw skill** (deploys 15 behavioral rules to agent context):
       - `npx openclaw secureclaw skill install`
       - Verify: `openclaw skills list` should show secureclaw skill as ready

    2. **Read the full SKILL.md to understand all 15 rules**:
       - Research found only 6 of 15 rules documented publicly. After install, read the actual SKILL.md:
       - `cat ~/.openclaw/skills/secureclaw/SKILL.md` (or wherever installed)
       - Map each of the 15 rules to Bob's known workflows to identify which need exceptions

    3. **Create workflow exceptions document** in Bob's workspace:
       Write `~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md` containing pre-approved patterns per user decisions:

       **Pre-approved patterns** (based on known rules and workflows):
       - **External content**: Semi-trusted API list: Gmail (gog), Resend, Oura, Govee, Wyze, WordPress (REST API), gog CLI. These are already behind Tailscale + SG + Docker. Full sandbox only for arbitrary web content (browser automation, web fetch).
       - **Destructive commands**: Pre-approve cron-triggered file writes to /workspace/, email sends via Resend API, health.db/coordination.db/content.db/email.db updates, ClawdStrike bundle regeneration.
       - **Read-then-send patterns**: Pre-approve: read calendar/email -> summarize -> send to owner via Slack DM or email. This covers morning briefing, evening recap, email monitoring, meeting prep.
       - **Credential protection**: Reinforces Docker sandbox boundary. gog CLI operations that reference keyring are expected behavior.
       - **Plan disclosure for crons**: Cron-triggered multi-step operations log their plan silently rather than requiring interactive approval. Human-initiated multi-step operations still state plan as normal.
       - **Supply chain scanning**: Default behavior (scan before install) is fine -- Bob rarely installs packages autonomously.

       Format the document as a standing instruction (like the Voice Notes Protocol pattern -- workspace protocol docs work reliably in OpenClaw per MEMORY.md).

    4. **Restart gateway to pick up new plugin + skill configuration**:
       - `systemctl --user restart openclaw-gateway.service`
       - Wait 10 seconds
       - `systemctl --user status openclaw-gateway.service` -- expect active (running)
       - Check logs: `journalctl --user -u openclaw-gateway.service --since '1 min ago' --no-pager | tail -30`
       - Look for: SecureClaw plugin loaded, secureclaw skill detected, no errors

    5. **Verify Bob responds to Slack DM**:
       - DM Bob via Slack to re-establish the DM session (gateway restart clears sessions per known behavior)
       - Confirm Bob responds coherently
       - This is a checkpoint:human-action in spirit but per user decision ("verify delivery immediately after restart") it's part of the smoke test

    6. **Smoke test: trigger a cron**:
       - Per Claude's discretion, use daily-heartbeat or any cron that can be manually triggered
       - `openclaw cron trigger <cron-name>` (or equivalent CLI command)
       - Verify the cron completes (check logs or delivery channel)
       - This confirms: gateway works, cron system works, agent processes with SecureClaw rules active, delivery works

    7. **Verify SecureClaw + ClawdStrike coexistence**:
       - `openclaw skills list` should show both secureclaw and clawdstrike skills
       - If conflict detected (both try to modify agent context in incompatible ways), disable ClawdStrike skill and keep it as manual host-level audit only

    Note: Per user decisions, gate cron jobs through SecureClaw too (no exemptions). The exceptions document pre-approves KNOWN patterns but novel actions still require the rules to apply.
  </action>
  <verify>
    SSH: `openclaw skills list` shows secureclaw skill as ready
    SSH: `cat ~/clawd/agents/main/SECURECLAW_EXCEPTIONS.md` exists and contains pre-approved workflow patterns
    SSH: `systemctl --user status openclaw-gateway.service` shows active (running)
    SSH: `journalctl --user -u openclaw-gateway.service --since '5 min ago' --no-pager | grep -i error` returns empty
    Slack: DM Bob and get a coherent response (session re-established)
    Cron: triggered cron completes and delivers output
  </verify>
  <done>
    SecureClaw 15 behavioral rules are active in Bob's agent context. Workflow exceptions document covers all known automation patterns (cron, email, browser, API integrations). Gateway is running with SecureClaw plugin loaded. Bob responds to Slack DM. Cron smoke test passed. Both SecureClaw and ClawdStrike skills coexist.
  </done>
</task>

</tasks>

<verification>
- `openclaw plugins list` shows SecureClaw loaded (SEC-02)
- `openclaw secureclaw audit` shows 0 critical findings (SEC-02)
- `openclaw skills list` shows secureclaw skill (SEC-03)
- SECURECLAW_EXCEPTIONS.md exists in agent workspace (SEC-03)
- Bob responds to Slack DM with SecureClaw active
- At least one cron fires successfully with behavioral rules active
- Phase 24 success criteria 2, 3, and 4 from ROADMAP.md are met
</verification>

<success_criteria>
SEC-02 and SEC-03 are fully satisfied: SecureClaw plugin is installed with a clean 51-check audit (zero critical findings). All 15 runtime behavioral rules are active with max strictness. Known workflow exceptions are pre-approved so existing cron/email/browser automation is not disrupted. Gateway is running, Bob is responsive, and a cron smoke test confirms end-to-end functionality. Combined with Plan 24-01, all four Phase 24 success criteria from the roadmap are met.
</success_criteria>

<output>
After completion, create `.planning/phases/24-critical-security-update/24-02-SUMMARY.md`
</output>
