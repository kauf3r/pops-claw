---
phase: 01-update-memory-security
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /home/ubuntu/.npm-global/lib/node_modules/openclaw (binary update)
  - /home/ubuntu/.config/systemd/user/openclaw-gateway.service (potential doctor fix)
  - /home/ubuntu/.openclaw/skills/ (safety scanner output)
autonomous: true

must_haves:
  truths:
    - "openclaw --version reports v2026.2.6"
    - "Gateway service is running and healthy after restart"
    - "openclaw doctor reports no issues"
    - "Safety scanner passes on ClawdStrike skill"
    - "ClawdStrike audit completes post-update with no regressions"
  artifacts:
    - path: "/home/ubuntu/.npm-global/bin/openclaw"
      provides: "Updated OpenClaw binary"
    - path: "/home/ubuntu/.config/systemd/user/openclaw-gateway.service"
      provides: "Running gateway service"
  key_links:
    - from: "openclaw binary"
      to: "gateway service"
      via: "systemd ExecStart"
      pattern: "openclaw.*gateway"
---

<objective>
Update OpenClaw from v2026.2.3-1 to v2026.2.6 and verify the deployment is healthy, then run safety and audit checks.

Purpose: v2026.2.6 brings Opus 4.6 support, token dashboard, session capping, and safety scanner â€” all prerequisites for memory, security, and multi-agent work.

Output: Running v2026.2.6 gateway with clean doctor and audit reports.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

SSH access: `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9`
Binary: `/home/ubuntu/.npm-global/bin/openclaw`
Service: `openclaw-gateway.service` (systemd user)
Current version: v2026.2.3-1
Target version: v2026.2.6
Update procedure: npm install -g openclaw@latest -> openclaw doctor --fix -> restart service
IMPORTANT: Use full binary path for non-interactive SSH. Use `tee` not heredocs over SSH.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update OpenClaw to v2026.2.6 and restart gateway</name>
  <files>
    /home/ubuntu/.npm-global/bin/openclaw
    /home/ubuntu/.config/systemd/user/openclaw-gateway.service
  </files>
  <action>
    SSH to EC2 and run the update sequence:

    1. Check current version:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 '/home/ubuntu/.npm-global/bin/openclaw --version'`

    2. Update to latest:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'npm install -g openclaw@latest'`

    3. Verify new version:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 '/home/ubuntu/.npm-global/bin/openclaw --version'`
       Must show v2026.2.6. If it shows something else, check npm registry.

    4. Run doctor with fix:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 '/home/ubuntu/.npm-global/bin/openclaw doctor --fix'`
       Watch for entry.js vs index.js mismatches. Doctor may update service file.

    5. Restart gateway service:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'systemctl --user restart openclaw-gateway.service'`

    6. Wait 5 seconds, then check status:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'systemctl --user status openclaw-gateway.service'`
       Must show active (running).

    7. Verify gateway responds:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'curl -s http://localhost:18789/health || echo "health endpoint not available"'`

    If doctor flags issues, fix them before restarting. Common: ExecStart path mismatch after update.
  </action>
  <verify>
    - `openclaw --version` returns v2026.2.6
    - `systemctl --user status openclaw-gateway.service` shows active (running)
    - `openclaw doctor` reports no critical issues
  </verify>
  <done>OpenClaw v2026.2.6 installed, doctor clean, gateway service running and healthy.</done>
</task>

<task type="auto">
  <name>Task 2: Run safety scanner and ClawdStrike audit</name>
  <files>
    /home/ubuntu/.openclaw/skills/ (scanner target)
    /home/ubuntu/clawd/agents/main/ (ClawdStrike bundle location)
  </files>
  <action>
    1. Run safety scanner on ClawdStrike skill:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 '/home/ubuntu/.npm-global/bin/openclaw safety-scan --skill clawdstrike'`
       If `safety-scan` is not a valid subcommand in v2026.2.6, check `openclaw --help` for the correct command (may be `openclaw scan`, `openclaw audit`, or similar).

    2. Review scanner output. Address any findings:
       - Critical: Must fix before proceeding
       - Warning: Document in progress.md, fix if quick
       - Info: Note and move on

    3. Re-run ClawdStrike audit:
       First, check if collect_verified.sh exists:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'ls ~/clawd/agents/main/collect_verified.sh 2>/dev/null || ls ~/clawd/collect_verified.sh 2>/dev/null || echo "not found"'`

       If found, run it:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'bash ~/clawd/agents/main/collect_verified.sh'`

       If not found, check the ClawdStrike skill directory:
       `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'ls ~/.openclaw/skills/clawdstrike/ 2>/dev/null'`

    4. Compare audit results against previous baseline (16/25 OK, 3 warn from MEMORY.md).
       Document any changes in progress.md.

    Note: Previous ClawdStrike score was 16/25 OK, 3 warn (all mitigated or cosmetic). Post-update score should be same or better.
  </action>
  <verify>
    - Safety scanner completes without critical findings
    - ClawdStrike audit runs and produces results
    - No regressions from previous 16/25 baseline
  </verify>
  <done>Safety scanner passes on ClawdStrike skill. ClawdStrike audit completes post-update with no regressions from 16/25 baseline.</done>
</task>

</tasks>

<verification>
1. `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 '/home/ubuntu/.npm-global/bin/openclaw --version'` -> v2026.2.6
2. `ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 'systemctl --user status openclaw-gateway.service'` -> active (running)
3. Safety scanner output shows no critical findings
4. ClawdStrike audit shows >= 16/25 OK
</verification>

<success_criteria>
- OpenClaw v2026.2.6 installed and running
- Gateway service healthy
- Doctor reports clean
- Safety scanner passes
- ClawdStrike audit has no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/01-update-memory-security/01-01-SUMMARY.md`
</output>
