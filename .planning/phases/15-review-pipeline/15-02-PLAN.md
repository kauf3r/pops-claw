---
phase: 15-review-pipeline
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - "~/.openclaw/cron/jobs.json (EC2)"
autonomous: true

must_haves:
  truths:
    - "Review-check cron fires 2x/day (10 AM PT and 3 PM PT) targeting Sage"
    - "Cron-triggered review session scores articles and routes them to 'approved' or 'revision'"
    - "Sage reads REVIEW_SESSION.md reference doc and follows its instructions"
  artifacts:
    - path: "~/.openclaw/cron/jobs.json"
      provides: "review-check cron entry targeting sage, 2x/day schedule"
      contains: "review-check"
  key_links:
    - from: "cron job (review-check)"
      to: "REVIEW_SESSION.md"
      via: "agentTurn message instructs reading the reference doc"
      pattern: "REVIEW_SESSION.md"
    - from: "REVIEW_SESSION.md"
      to: "content-editor SKILL.md"
      via: "References skill for editorial review workflow"
      pattern: "content-editor"
    - from: "REVIEW_SESSION.md"
      to: "/workspace/content.db"
      via: "UPDATE articles SET seo_score, readability_score, accuracy_score, reviewer_notes, status"
      pattern: "UPDATE articles"
---

<objective>
Add the 2x/day review-check cron job for Sage's editorial review sessions.

Purpose: Automate editorial review so Sage runs twice daily, claims articles from the review queue, scores them (SEO/readability/accuracy), and routes them to 'approved' or 'revision' with actionable feedback.
Output: review-check cron job in jobs.json firing at 10 AM PT and 3 PM PT.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-review-pipeline/15-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add review-check cron job (2x/day at 10 AM and 3 PM PT)</name>
  <files>~/.openclaw/cron/jobs.json (EC2)</files>
  <action>
Add a new cron job to `~/.openclaw/cron/jobs.json` on EC2 for 2x/day editorial review sessions.

**Cron schedule:** Twice daily at 10:00 AM and 3:00 PM PT
- `0 10,15 * * *` with `tz: "America/Los_Angeles"` -- fires at 10 AM and 3 PM PT daily, DST-safe
- 10 AM run catches articles from previous day's writing session (11 AM PT)
- 3 PM run catches any articles that entered review mid-day or revision resubmissions
- Staggered from Quill's 11 AM writing session by 1 hour (morning) and 4 hours (afternoon)

**Job configuration:**
The job must use `sessionTarget: "sage"` with `kind: "agentTurn"` (content agents use agentTurn, not systemEvent). This runs in Docker sandbox, not embedded mode.

```json
{
  "id": "review-check",
  "name": "review-check",
  "cron": "0 10,15 * * *",
  "tz": "America/Los_Angeles",
  "enabled": true,
  "sessionTarget": "sage",
  "payload": {
    "kind": "agentTurn",
    "message": "Review Session: Read /workspace/REVIEW_SESSION.md and follow its instructions to review articles in the queue, score them (SEO/readability/accuracy), and route them to approved or revision. Post your summary to #content-pipeline when done.",
    "model": "sonnet",
    "timeoutSeconds": 600
  }
}
```

**Implementation steps:**
1. SSH to EC2 and read current jobs.json
2. Add the new job entry to the jobs array
3. **Do NOT include a `delivery` key** -- per lessons learned, delivery.mode announce only works with sessionTarget "isolated", and sage is a named agent session. If gateway auto-adds delivery on restart, remove it.
4. Write updated jobs.json
5. Restart gateway to load new cron: `systemctl --user restart openclaw-gateway`
6. Verify cron loaded by checking gateway logs
7. If gateway auto-populated delivery config, remove it and restart again

**IMPORTANT notes:**
- Use `sessionTarget: "sage"` (NOT "isolated") -- targets Sage's agent session
- Use `kind: "agentTurn"` with `message` field (NOT `kind: "systemEvent"` with `text` field) -- required for non-main sessionTarget
- Use `model: "sonnet"` -- review needs reasoning but not opus-level
- Use `timeoutSeconds: 600` (10 min) -- reviewing multiple articles + fact-checking + DB operations
- Path in message is `/workspace/REVIEW_SESSION.md` (sandbox path, since agentTurn runs in Docker)
- No `delivery` config -- response stays in agent's session
- Use `tz: "America/Los_Angeles"` for DST-safe scheduling (same pattern as writing-check and topic-research crons)
  </action>
  <verify>
SSH to EC2 and confirm:
1. `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; jobs=json.load(sys.stdin)['jobs']; matches=[j for j in jobs if j.get('id')=='review-check' or j.get('name')=='review-check']; print(json.dumps(matches, indent=2))"` -- returns the review-check job
2. Verify cron schedule is `0 10,15 * * *`
3. Verify `tz` is `America/Los_Angeles`
4. Verify `sessionTarget` is `sage`
5. Verify `payload.kind` is `agentTurn`
6. Verify `payload.message` references `REVIEW_SESSION.md`
7. Verify `payload.timeoutSeconds` is 600
8. Verify NO `delivery` key exists in the job
9. `systemctl --user is-active openclaw-gateway` -- returns "active"
10. Check gateway logs for cron loading: `journalctl --user -u openclaw-gateway -n 30 --no-pager | grep -i "cron\|review-check"`
11. Count total cron jobs to ensure no regressions: `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; print(len(json.load(sys.stdin)['jobs']))"`
  </verify>
  <done>review-check cron job added to jobs.json firing 2x/day at 10 AM and 3 PM PT, targeting sage with agentTurn, sonnet model, 10-min timeout, no delivery config</done>
</task>

</tasks>

<verification>
After task completion:
1. Cron job `review-check` exists in jobs.json with correct config
2. Gateway service active and cron loaded
3. All existing cron jobs continue functioning (no regressions)
4. No delivery config on the job (prevents announce-mode errors)
5. Optional manual trigger test: `openclaw cron run review-check --timeout 600000`
   - Should read REVIEW_SESSION.md, check review queue, claim article, score it, route to approved/revision
   - Should post summary to #content-pipeline
</verification>

<success_criteria>
- review-check cron job in jobs.json: 2x/day at 10 AM and 3 PM PT, sessionTarget sage, agentTurn, sonnet, 600s timeout, no delivery config
- Gateway restarts cleanly with new cron job loaded
- All existing cron jobs continue functioning (no regressions)
- Total cron count increases by 1 from baseline
</success_criteria>

<output>
After completion, create `.planning/phases/15-review-pipeline/15-02-SUMMARY.md`
</output>
