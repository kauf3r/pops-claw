---
phase: 13-topic-research
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - "~/clawd/agents/rangeos/TOPIC_RESEARCH.md (EC2)"
  - "~/.openclaw/cron/jobs.json (EC2)"
autonomous: true

must_haves:
  truths:
    - "Topic research cron fires 2x/week targeting Vector (rangeos)"
    - "Cron-triggered research session produces 3-5 topics in content.db"
    - "Vector reads TOPIC_RESEARCH.md reference doc and follows its instructions"
  artifacts:
    - path: "~/clawd/agents/rangeos/TOPIC_RESEARCH.md"
      provides: "Cron reference doc with step-by-step research instructions and content.db queries"
      contains: "Topic Research Session"
    - path: "~/.openclaw/cron/jobs.json"
      provides: "topic-research cron entry targeting rangeos, 2x/week schedule"
      contains: "topic-research"
  key_links:
    - from: "cron job (topic-research)"
      to: "TOPIC_RESEARCH.md"
      via: "agentTurn message instructs reading the reference doc"
      pattern: "TOPIC_RESEARCH.md"
    - from: "TOPIC_RESEARCH.md"
      to: "content-strategy SKILL.md"
      via: "References skill for research workflow"
      pattern: "content-strategy"
    - from: "TOPIC_RESEARCH.md"
      to: "/workspace/content.db"
      via: "SQLite INSERT into topics + pipeline_activity"
      pattern: "INSERT INTO topics"
---

<objective>
Create TOPIC_RESEARCH.md reference doc and add 2x/week cron job for Vector's topic research sessions.

Purpose: Automate topic research so Vector runs twice weekly, finds UAS content opportunities, and populates the content.db backlog for downstream writers.
Output: TOPIC_RESEARCH.md in rangeos workspace + topic-research cron job in jobs.json.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-topic-research/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TOPIC_RESEARCH.md reference doc in rangeos workspace</name>
  <files>~/clawd/agents/rangeos/TOPIC_RESEARCH.md (EC2)</files>
  <action>
Create a reference document at `~/clawd/agents/rangeos/TOPIC_RESEARCH.md` on EC2 that the cron-triggered agent will read and follow.

This follows the established reference doc pattern (MEETING_PREP.md, STANDUP.md, ANOMALY_ALERTS.md, EXPENSE_SUMMARY.md).

**CRITICAL:** This runs in sandbox (Docker), NOT embedded mode. Vector's cron uses `sessionTarget: "rangeos"` with `kind: "agentTurn"`, which runs in Docker sandbox. Use `/workspace/` paths for content.db, NOT host paths.

**Content for TOPIC_RESEARCH.md:**

```markdown
# Topic Research Session

You are Vector, the topic researcher for AirSpace Integration's content marketing pipeline. This document guides your bi-weekly research session.

## Before You Start

1. Read your PRODUCT_CONTEXT.md for UAS domain rules (DO/DON'T list)
2. Check current backlog health:

```sql
SELECT status, COUNT(*) as cnt FROM topics GROUP BY status;
```

If there are 10+ topics in 'backlog' status, skip research this session. Post to #content-pipeline: "Backlog healthy (N topics pending) - skipping research this session." and stop.

3. Check what was recently created (avoid duplication):

```sql
SELECT title, keywords, created_at FROM topics ORDER BY created_at DESC LIMIT 10;
```

## Research Process

Use the content-strategy skill for your research workflow. Key steps:

### Step 1: Find Content Opportunities

Search for recent UAS/drone industry developments (last 30-60 days):
- Use browser to search news sites, industry publications
- Check Google for trending commercial drone topics
- Look at competitor blogs for content gaps
- Review FAA.gov for regulatory updates

Focus areas (rotate each session to ensure variety):
- Commercial applications (agriculture, construction, energy, infrastructure, mining, real estate)
- Technology trends (LiDAR, photogrammetry, thermal, RTK, AI/ML)
- Regulatory updates (Part 107, remote ID, BVLOS)
- Case studies and ROI data

### Step 2: Evaluate and Filter

For each potential topic, verify:
- [ ] Aligns with PRODUCT_CONTEXT.md DO rules
- [ ] Does NOT violate any DON'T rules
- [ ] Not a duplicate of existing topics in content.db
- [ ] Has enough substance for a 1500+ word article
- [ ] Relevant to commercial drone service providers (our audience)

### Step 3: Create Topic Briefs

For each approved topic, use the content-strategy skill's INSERT pattern:

```sql
BEGIN IMMEDIATE;

INSERT INTO topics (title, slug, brief, keywords, content_type, status, priority, source_url)
VALUES (
  '<descriptive title, 50-70 chars>',
  '<url-slug>',
  '<2-3 sentence brief: angle + audience + key points>',
  '<5-8 comma-separated SEO keywords>',
  'article',
  'backlog',
  <1=high, 2=medium, 3=low>,
  '<source URL or NULL>'
);

INSERT INTO pipeline_activity (entity_type, entity_id, agent_id, action, old_status, new_status, details)
VALUES ('topics', last_insert_rowid(), 'rangeos', 'created', NULL, 'backlog', '<reason for topic selection>');

COMMIT;
```

Database path: `/workspace/content.db`

### Step 4: Session Summary

After inserting topics, generate a summary:

```sql
SELECT id, title, priority FROM topics WHERE created_at > datetime('now', '-1 hour') ORDER BY priority;
```

Post your research summary to #content-pipeline with:
- Number of new topics added
- Brief list of titles with priority levels
- Any notable industry trends observed
- Current backlog size

## Target Output

- 3-5 new topics per session
- Mix of priorities (at least 1 high-priority if possible)
- Variety across verticals (don't cluster all in one area)

## Error Handling

- If content.db is locked: retry after 2 seconds, max 3 retries
- If web research fails: create topics from domain knowledge + PRODUCT_CONTEXT.md verticals
- If duplicate found: skip and note "Similar to topic #N"
- Always validate against PRODUCT_CONTEXT.md rules before INSERT
```

Write this file via SSH to the EC2 instance.
  </action>
  <verify>
SSH to EC2 and confirm:
1. `ls -la ~/clawd/agents/rangeos/TOPIC_RESEARCH.md` — file exists
2. `head -3 ~/clawd/agents/rangeos/TOPIC_RESEARCH.md` — starts with "# Topic Research Session"
3. `grep -c "INSERT INTO topics" ~/clawd/agents/rangeos/TOPIC_RESEARCH.md` — returns at least 1
4. `grep -c "/workspace/content.db" ~/clawd/agents/rangeos/TOPIC_RESEARCH.md` — returns at least 1 (sandbox paths, not host paths)
  </verify>
  <done>TOPIC_RESEARCH.md deployed to rangeos workspace with complete research session instructions, content.db queries, and backlog management</done>
</task>

<task type="auto">
  <name>Task 2: Add topic-research cron job (2x/week)</name>
  <files>~/.openclaw/cron/jobs.json (EC2)</files>
  <action>
Add a new cron job to `~/.openclaw/cron/jobs.json` on EC2 for bi-weekly topic research.

**Cron schedule:** Tuesday and Friday at 10:00 AM PT (17:00 UTC)
- `0 17 * * 2,5` — fires at 17:00 UTC on Tuesday and Friday
- Tuesday and Friday spread research across the week
- 10 AM PT is during work hours, after morning briefing

**Job configuration:**
The job must use `sessionTarget: "rangeos"` with `kind: "agentTurn"` (content agents use agentTurn, not systemEvent). This runs in Docker sandbox, not embedded mode.

```json
{
  "id": "topic-research",
  "name": "topic-research",
  "cron": "0 17 * * 2,5",
  "enabled": true,
  "sessionTarget": "rangeos",
  "delivery": {},
  "payload": {
    "kind": "agentTurn",
    "message": "Topic Research Session: Read /workspace/TOPIC_RESEARCH.md and follow its instructions to research UAS industry topics and create content briefs in /workspace/content.db. Post your summary to #content-pipeline when done.",
    "model": "sonnet",
    "timeoutSeconds": 300
  }
}
```

**Implementation steps:**
1. SSH to EC2 and read current jobs.json
2. Add the new job entry to the jobs array
3. Write updated jobs.json
4. Restart gateway to load new cron: `systemctl --user restart openclaw-gateway`
5. Verify cron loaded by checking gateway logs

**IMPORTANT notes:**
- Use `sessionTarget: "rangeos"` (NOT "isolated") — targets Vector's agent session
- Use `kind: "agentTurn"` with `message` field (NOT `kind: "systemEvent"` with `text` field) — required for non-main sessionTarget
- Use `model: "sonnet"` — research needs reasoning but not opus-level
- Use `timeoutSeconds: 300` (5 min) — web research + multiple DB writes takes time
- Path in message is `/workspace/TOPIC_RESEARCH.md` (sandbox path, since agentTurn runs in Docker)
- `delivery: {}` — empty because response stays in agent's session (no announce needed)
- Verify channel ID casing is preserved (known CLI issue with lowercasing)
  </action>
  <verify>
SSH to EC2 and confirm:
1. `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; jobs=json.load(sys.stdin)['jobs']; matches=[j for j in jobs if j.get('id')=='topic-research' or j.get('name')=='topic-research']; print(json.dumps(matches, indent=2))"` — returns the topic-research job
2. Verify cron schedule is `0 17 * * 2,5`
3. Verify `sessionTarget` is `rangeos`
4. Verify `payload.kind` is `agentTurn`
5. Verify `payload.message` references `TOPIC_RESEARCH.md`
6. `systemctl --user is-active openclaw-gateway` — returns "active"
7. Check gateway logs for cron loading: `journalctl --user -u openclaw-gateway -n 30 --no-pager | grep -i "cron\|topic-research"`
8. Optional: manual test trigger: `openclaw cron run topic-research --timeout 300000` (only if user approves, as it will create real topics)
  </verify>
  <done>topic-research cron job added to jobs.json firing Tuesday + Friday at 10 AM PT, targeting rangeos with agentTurn, sonnet model, 5-min timeout</done>
</task>

</tasks>

<verification>
After both tasks:
1. `ls ~/clawd/agents/rangeos/TOPIC_RESEARCH.md` — reference doc exists
2. Cron job `topic-research` exists in jobs.json with correct config
3. Gateway service active and cron loaded
4. Manual trigger test (optional): `openclaw cron run topic-research --timeout 300000`
   - Should read TOPIC_RESEARCH.md, check backlog, research topics, insert into content.db
   - Should post summary to #content-pipeline
</verification>

<success_criteria>
- TOPIC_RESEARCH.md deployed to rangeos workspace with research instructions using /workspace/ sandbox paths
- topic-research cron job in jobs.json: 2x/week (Tue+Fri 10AM PT), sessionTarget rangeos, agentTurn, sonnet, 300s timeout
- Gateway restarts cleanly with new cron job loaded
- All existing cron jobs continue functioning (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/13-topic-research/13-02-SUMMARY.md`
</output>
