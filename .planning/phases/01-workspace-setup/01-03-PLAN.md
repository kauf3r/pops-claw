---
phase: 01-workspace-setup
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - ~/clawd/agents/main/HEARTBEAT.md
  - ~/clawd/agents/landos/HEARTBEAT.md
  - ~/clawd/agents/rangeos/HEARTBEAT.md
  - ~/clawd/agents/ops/HEARTBEAT.md
autonomous: true

must_haves:
  truths:
    - "Each agent has HEARTBEAT.md defining recurring task templates"
    - "Heartbeat tasks are domain-appropriate"
    - "Task templates are actionable without additional context"
  artifacts:
    - path: "~/clawd/agents/main/HEARTBEAT.md"
      provides: "Andy heartbeat tasks"
      contains: "## Heartbeat Tasks"
    - path: "~/clawd/agents/landos/HEARTBEAT.md"
      provides: "Scout heartbeat tasks"
      contains: "## Heartbeat Tasks"
    - path: "~/clawd/agents/rangeos/HEARTBEAT.md"
      provides: "Vector heartbeat tasks"
      contains: "## Heartbeat Tasks"
    - path: "~/clawd/agents/ops/HEARTBEAT.md"
      provides: "Sentinel heartbeat tasks"
      contains: "## Heartbeat Tasks"
  key_links:
    - from: "~/clawd/agents/*/HEARTBEAT.md"
      to: "agent_tasks table"
      via: "task creation on heartbeat"
    - from: "~/clawd/agents/*/HEARTBEAT.md"
      to: "agent_messages table"
      via: "message checking on heartbeat"
---

<objective>
Create HEARTBEAT.md task template files for all 4 agents, defining what each agent does on every heartbeat cycle.

Purpose: Heartbeats are the autonomous execution loop - each agent needs a defined set of recurring checks and actions.
Output: 4 HEARTBEAT.md files, one per agent directory.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md

Depends on 01-01 (directories must exist).
Can run parallel with 01-02 (SOUL.md creation).

Heartbeat schedule from PROJECT.md:
- main (Andy): :00
- landos (Scout): :02
- rangeos (Vector): :04
- ops (Sentinel): :06
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Andy (main) HEARTBEAT.md</name>
  <files>~/clawd/agents/main/HEARTBEAT.md</files>
  <action>
Create HEARTBEAT.md for Andy, the coordinator agent:

```markdown
# Andy - Heartbeat Tasks

## Schedule

- **Frequency:** Every 15 minutes
- **Offset:** :00 (top of quarter hour)
- **Duration:** ~2 minutes max

## Heartbeat Checklist

### 1. Check Messages
```sql
SELECT * FROM agent_messages
WHERE to_agent = 'main' AND read_at IS NULL
ORDER BY created_at;
```
- Process each unread message
- Mark as read after processing
- Respond or route as needed

### 2. Check Assigned Tasks
```sql
SELECT * FROM agent_tasks
WHERE agent_id = 'main' AND status = 'pending'
ORDER BY priority DESC, created_at;
```
- Review pending tasks
- Execute or delegate as appropriate
- Update status when complete

### 3. Review Shared Context
- Read ~/clawd/shared/memory/WORKING.md
- Check for cross-agent coordination needs
- Update if handling multi-domain work

### 4. Log Activity
```sql
INSERT INTO agent_activity (agent_id, activity_type, summary, created_at)
VALUES ('main', 'heartbeat', '[summary of actions taken]', datetime('now'));
```

## Routing Rules

| Keyword/Topic | Route To |
|---------------|----------|
| land, property, deal, county | Scout (landos) |
| drone, flight, airspace, UAS | Vector (rangeos) |
| server, deploy, backup, cron | Sentinel (ops) |
| urgent, blocked, help | Handle directly |

## Notes

- Keep heartbeat under 2 minutes to avoid overlap
- Prioritize routing over direct handling
- Log even if no actions taken ("no pending items")
```

SSH command:
```bash
ssh ubuntu@100.72.143.9 'cat > ~/clawd/agents/main/HEARTBEAT.md << "EOF"
[content above]
EOF'
```
  </action>
  <verify>
Run: `ssh ubuntu@100.72.143.9 'head -15 ~/clawd/agents/main/HEARTBEAT.md'`
Should show "# Andy - Heartbeat Tasks" and Schedule section.
  </verify>
  <done>
Andy/main HEARTBEAT.md exists with message checking, task review, and routing rules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Scout (landos) HEARTBEAT.md</name>
  <files>~/clawd/agents/landos/HEARTBEAT.md</files>
  <action>
Create HEARTBEAT.md for Scout, the land investing agent:

```markdown
# Scout - Heartbeat Tasks

## Schedule

- **Frequency:** Every 15 minutes
- **Offset:** :02
- **Duration:** ~2 minutes max

## Heartbeat Checklist

### 1. Check Messages
```sql
SELECT * FROM agent_messages
WHERE to_agent = 'landos' AND read_at IS NULL
ORDER BY created_at;
```
- Process deal requests
- Answer research questions
- Acknowledge task handoffs

### 2. Check Assigned Tasks
```sql
SELECT * FROM agent_tasks
WHERE agent_id = 'landos' AND status = 'pending'
ORDER BY priority DESC, created_at;
```
- Execute property research
- Update deal analyses
- Complete due diligence items

### 3. Pipeline Check
- Review active deals in pipeline
- Check for approaching deadlines (< 7 days)
- Flag urgent items to Andy

### 4. Log Activity
```sql
INSERT INTO agent_activity (agent_id, activity_type, summary, created_at)
VALUES ('landos', 'heartbeat', '[summary of actions taken]', datetime('now'));
```

## Domain Tasks

### Property Research
1. Pull county records
2. Check zoning/restrictions
3. Verify access and utilities
4. Run comparable analysis

### Deal Analysis
1. Score against investment criteria
2. Calculate projected ROI
3. Identify risks
4. Provide recommendation

### Due Diligence
1. Title search status
2. Survey coordination
3. Document collection
4. Deadline tracking

## Escalation

- Deals needing decision: Message Andy
- Infrastructure issues: Message Sentinel
- Blocked on research: Log and retry next heartbeat
```

SSH command:
```bash
ssh ubuntu@100.72.143.9 'cat > ~/clawd/agents/landos/HEARTBEAT.md << "EOF"
[content above]
EOF'
```
  </action>
  <verify>
Run: `ssh ubuntu@100.72.143.9 'head -15 ~/clawd/agents/landos/HEARTBEAT.md'`
Should show "# Scout - Heartbeat Tasks" and Schedule section.
  </verify>
  <done>
Scout/landos HEARTBEAT.md exists with land investing tasks, pipeline check, and domain task templates.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Vector (rangeos) and Sentinel (ops) HEARTBEAT.md files</name>
  <files>
    ~/clawd/agents/rangeos/HEARTBEAT.md
    ~/clawd/agents/ops/HEARTBEAT.md
  </files>
  <action>
Create HEARTBEAT.md for Vector (UAS operations) and Sentinel (infrastructure).

**Vector - UAS Operations Agent:**

```markdown
# Vector - Heartbeat Tasks

## Schedule

- **Frequency:** Every 15 minutes
- **Offset:** :04
- **Duration:** ~2 minutes max

## Heartbeat Checklist

### 1. Check Messages
```sql
SELECT * FROM agent_messages
WHERE to_agent = 'rangeos' AND read_at IS NULL
ORDER BY created_at;
```
- Process flight requests
- Answer airspace questions
- Acknowledge coordination needs

### 2. Check Assigned Tasks
```sql
SELECT * FROM agent_tasks
WHERE agent_id = 'rangeos' AND status = 'pending'
ORDER BY priority DESC, created_at;
```
- Plan requested flights
- Check NOTAM status
- Update equipment logs

### 3. Operations Check
- Review scheduled flights (next 48 hours)
- Check weather conditions
- Verify LAANC authorizations

### 4. Log Activity
```sql
INSERT INTO agent_activity (agent_id, activity_type, summary, created_at)
VALUES ('rangeos', 'heartbeat', '[summary of actions taken]', datetime('now'));
```

## Domain Tasks

### Flight Planning
1. Define mission parameters
2. Risk assessment
3. Crew assignment
4. Equipment check

### Airspace Coordination
1. Check LAANC availability
2. Monitor NOTAMs
3. File as needed
4. Deconfliction check

### Weather Monitoring
1. Current conditions
2. Forecast review
3. Go/no-go assessment
4. Window identification

## Safety Rules

- Never approve flights without weather check
- Always verify airspace authorization
- Document all go/no-go decisions
- Escalate equipment issues immediately
```

**Sentinel - Infrastructure Agent:**

```markdown
# Sentinel - Heartbeat Tasks

## Schedule

- **Frequency:** Every 15 minutes
- **Offset:** :06
- **Duration:** ~2 minutes max
- **Special:** Daily standup at 8 AM EST (13:00 UTC)

## Heartbeat Checklist

### 1. Check Messages
```sql
SELECT * FROM agent_messages
WHERE to_agent = 'ops' AND read_at IS NULL
ORDER BY created_at;
```
- Process infrastructure requests
- Respond to alerts
- Coordinate maintenance

### 2. Check Assigned Tasks
```sql
SELECT * FROM agent_tasks
WHERE agent_id = 'ops' AND status = 'pending'
ORDER BY priority DESC, created_at;
```
- Execute maintenance tasks
- Run health checks
- Update configurations

### 3. System Health Check
- EC2 instance status
- Service health (gateway, cron)
- API connectivity
- Disk/memory usage

### 4. Log Activity
```sql
INSERT INTO agent_activity (agent_id, activity_type, summary, created_at)
VALUES ('ops', 'heartbeat', '[summary of actions taken]', datetime('now'));
```

## Daily Standup (8 AM EST)

### Aggregation Query
```sql
SELECT agent_id, activity_type, summary, created_at
FROM agent_activity
WHERE created_at > datetime('now', '-24 hours')
ORDER BY agent_id, created_at;
```

### Standup Format
```
## Daily Standup - [Date]

### Andy (Coordinator)
- [activity summary]

### Scout (Land Investing)
- [activity summary]

### Vector (UAS Operations)
- [activity summary]

### Sentinel (Infrastructure)
- [activity summary]

### Blockers
- [any identified blockers]

### Today's Priorities
- [derived from pending tasks]
```

## Domain Tasks

### Health Monitoring
1. Check EC2 metrics
2. Review service logs
3. Verify cron execution
4. Test API endpoints

### Maintenance
1. Log rotation
2. Backup verification
3. Credential checks
4. Security updates

## Severity Levels

| Level | Action |
|-------|--------|
| INFO | Log only |
| WARNING | Log + note in standup |
| CRITICAL | Log + immediate alert to Andy |
```

SSH commands:
```bash
# Vector
ssh ubuntu@100.72.143.9 'cat > ~/clawd/agents/rangeos/HEARTBEAT.md << "EOF"
[Vector content above]
EOF'

# Sentinel
ssh ubuntu@100.72.143.9 'cat > ~/clawd/agents/ops/HEARTBEAT.md << "EOF"
[Sentinel content above]
EOF'
```
  </action>
  <verify>
Run both:
- `ssh ubuntu@100.72.143.9 'head -5 ~/clawd/agents/rangeos/HEARTBEAT.md'` -> "# Vector - Heartbeat Tasks"
- `ssh ubuntu@100.72.143.9 'head -5 ~/clawd/agents/ops/HEARTBEAT.md'` -> "# Sentinel - Heartbeat Tasks"
  </verify>
  <done>
Vector/rangeos and Sentinel/ops HEARTBEAT.md files exist with domain-specific heartbeat tasks.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify all 4 HEARTBEAT.md files exist:

```bash
ssh ubuntu@100.72.143.9 'for f in ~/clawd/agents/*/HEARTBEAT.md; do echo "=== $f ===" && head -3 "$f"; done'
```

Expected output shows 4 files with correct headers:
- Andy - Heartbeat Tasks
- Scout - Heartbeat Tasks
- Vector - Heartbeat Tasks
- Sentinel - Heartbeat Tasks

Requirements covered:
- WS-07: HEARTBEAT.md task file for each agent (4 files)
</verification>

<success_criteria>
- [ ] 4 HEARTBEAT.md files exist, one per agent directory
- [ ] Each HEARTBEAT.md has Schedule, Checklist, Domain Tasks sections
- [ ] Heartbeat offsets match: :00, :02, :04, :06
- [ ] Sentinel includes daily standup template
</success_criteria>

<output>
After completion, create `.planning/phases/01-workspace-setup/01-03-SUMMARY.md`
</output>
