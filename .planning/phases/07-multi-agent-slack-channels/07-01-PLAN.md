---
phase: 07-multi-agent-slack-channels
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Three domain channels exist in Slack (#land-ops, #range-ops, #ops)"
    - "Bot is a member of all three channels"
    - "Message in #land-ops routes to Scout (landos agent)"
    - "Message in #range-ops routes to Vector (rangeos agent)"
    - "Message in #ops routes to Sentinel (ops agent)"
  artifacts: []
  key_links:
    - from: "Slack channel #land-ops"
      to: "landos agent"
      via: "openclaw.json agents.landos.slack.channels"
      pattern: "land-ops"
    - from: "Slack channel #range-ops"
      to: "rangeos agent"
      via: "openclaw.json agents.rangeos.slack.channels"
      pattern: "range-ops"
    - from: "Slack channel #ops"
      to: "ops agent"
      via: "openclaw.json agents.ops.slack.channels"
      pattern: "ops"
---

<objective>
Create domain Slack channels, invite bot, and verify message routing to correct agents.

Purpose: Each agent (Scout, Vector, Sentinel) needs a dedicated Slack channel so messages are routed to the right agent. Phase 6 configured the gateway bindings; this phase creates the actual Slack channels and proves end-to-end routing works.

Output: Three Slack channels with verified bot membership and confirmed message routing.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-multi-agent-gateway/06-01-SUMMARY.md
@.planning/phases/06-multi-agent-gateway/06-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit current Slack channel state</name>
  <files></files>
  <action>
SSH to EC2 (100.72.143.9) and check the current state of Slack channels and bot membership.

1. Read the openclaw.json to extract the exact channel IDs or names configured for each agent binding:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "cat ~/.openclaw/openclaw.json" | jq '.agents'
   ```
   Document: which channels are bound to which agents, and any channel IDs already configured.

2. Check gateway logs for recent Slack activity to confirm which channels the bot is already active in:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "journalctl --user -u openclaw-gateway.service --since '1 hour ago' --no-pager | grep -i 'channel\|slack\|land-ops\|range-ops\|#ops' | tail -20"
   ```

3. From Phase 6 we know:
   - #land-ops EXISTS and Scout was confirmed there
   - #range-ops and #ops may or may not exist yet
   - Gateway has bindings for all 4 agents (main + 3 domain agents)

Report findings: which channels exist, which need creation, bot membership status.
  </action>
  <verify>Output shows current channel bindings from openclaw.json and identifies which channels exist vs need creation.</verify>
  <done>Clear inventory of existing channels and gaps documented.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Create missing Slack channels and invite bot</name>
  <action>
Based on Task 1 audit, the user must perform these manual steps in Slack:

**Create channels (skip any that already exist):**
1. In Slack, create channel **#range-ops** (if missing)
   - Purpose: "UAS/drone operations — Vector agent"
2. In Slack, create channel **#ops** (if missing)
   - Purpose: "Infrastructure & coding — Sentinel agent"
3. Verify **#land-ops** exists (created in Phase 6)

**Invite bot to channels:**
4. In each channel (#land-ops, #range-ops, #ops), type `/invite @Bob` (or whatever the bot's Slack display name is) to add the bot
5. Skip any channel where the bot is already a member

**Important:** The channel names must match exactly what's configured in openclaw.json bindings. Check Task 1 output for exact names.
  </action>
  <resume-signal>Type "channels ready" when all channels exist and bot is invited to each, or describe any issues.</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify message routing for all domain channels</name>
  <files></files>
  <action>
After the user confirms channels are ready, verify end-to-end routing:

1. **Check gateway sees all channels.** Restart gateway to pick up any new channel memberships:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "systemctl --user restart openclaw-gateway.service && sleep 5 && systemctl --user status openclaw-gateway.service --no-pager"
   ```

2. **Verify bot is member of all channels.** Check gateway logs for channel join events or Slack API calls:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "journalctl --user -u openclaw-gateway.service --since '2 min ago' --no-pager | grep -i 'channel\|join\|land-ops\|range-ops\|ops' | tail -20"
   ```

3. **Test routing for each channel.** Send a test message to each channel and verify the correct agent responds. The user should send a brief message like "ping" or "status" in each channel:
   - #land-ops → expect Scout (landos) to respond
   - #range-ops → expect Vector (rangeos) to respond
   - #ops → expect Sentinel (ops) to respond

   Alternatively, check coordination DB for recent agent activity after user sends messages:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "sqlite3 ~/clawd/coordination.db \"SELECT agent_id, activity_type, created_at FROM agent_activity ORDER BY created_at DESC LIMIT 10;\""
   ```

4. **Verify heartbeat crons still work** for all agents after restart:
   ```
   ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9 "cat ~/.openclaw/cron/jobs.json | python3 -c \"import sys,json; jobs=json.load(sys.stdin); [print(f\\\"{j['id']}: {j.get('lastStatus','unknown')}\\\") for j in jobs]\""
   ```

5. **Final check:** Confirm all 5 MS requirements are met:
   - MS-01: #land-ops exists ✓
   - MS-02: #range-ops exists ✓
   - MS-03: #ops exists ✓
   - MS-04: Bot is member of all channels ✓
   - MS-05: Messages route to correct agent ✓
  </action>
  <verify>All 3 channels have bot membership, gateway is healthy, and at least one routing test confirms correct agent received the message.</verify>
  <done>All 5 MS requirements verified: 3 channels exist, bot is member, messages route to correct agents.</done>
</task>

</tasks>

<verification>
1. Gateway status shows all 4 agents loaded
2. Three domain channels (#land-ops, #range-ops, #ops) exist in Slack
3. Bot is a member of all three channels
4. Message in #land-ops reaches Scout (landos)
5. Message in #range-ops reaches Vector (rangeos)
6. Message in #ops reaches Sentinel (ops)
7. Heartbeat crons still show "ok" for all agents
</verification>

<success_criteria>
- All 3 domain Slack channels exist and bot is a member
- At least one message routing test confirms correct agent per channel
- Gateway healthy with all agents loaded
- All 5 MS requirements (MS-01 through MS-05) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/07-multi-agent-slack-channels/07-01-SUMMARY.md`
</output>
