---
phase: 03-daily-briefing-rate-limits
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /home/ubuntu/.openclaw/openclaw.json
autonomous: true

must_haves:
  truths:
    - "Model aliases 'haiku', 'sonnet', 'opus' resolve to correct Anthropic model IDs"
    - "Heartbeat cron jobs use Haiku model"
    - "Default model is Sonnet for general use"
    - "Session history is capped to prevent unbounded growth"
  artifacts:
    - path: "/home/ubuntu/.openclaw/openclaw.json"
      provides: "Model aliases, fallbacks, session historyLimit, compaction config"
  key_links:
    - from: "openclaw models aliases"
      to: "cron --model alias"
      via: "alias resolution"
      pattern: "haiku|sonnet|opus"
---

<objective>
Configure model routing (Haiku/Sonnet/Opus aliases), set heartbeat crons to use Haiku, configure session history capping, and enable compaction safeguard mode.

Purpose: Manage rate limits by routing cheap tasks to Haiku, standard tasks to Sonnet, and reserving Opus for complex reasoning. Cap session history to prevent unbounded context growth.
Output: openclaw.json with model aliases, historyLimit, and compaction; heartbeat crons updated with --model haiku.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure model aliases, default model, and session capping</name>
  <files>/home/ubuntu/.openclaw/openclaw.json</files>
  <action>
SSH to 100.72.143.9 and run the following commands (use full path `/home/ubuntu/.npm-global/bin/openclaw`):

1. **Set model aliases** (RL-01, RL-02, RL-03):
   ```
   openclaw models aliases add haiku anthropic/claude-haiku-4-5
   openclaw models aliases add sonnet anthropic/claude-sonnet-4-5
   openclaw models aliases add opus anthropic/claude-opus-4-5
   ```

2. **Set default model to Sonnet** (RL-02 — Sonnet for general briefings/analysis):
   ```
   openclaw models set sonnet
   ```

3. **Add Opus as fallback** (RL-03 — available if needed):
   ```
   openclaw models fallbacks add opus
   ```

4. **Enable session history capping** (RL-04):
   ```
   openclaw config set session.historyLimit 100 --json
   ```

5. **Enable compaction safeguard mode with memory flush**:
   ```
   openclaw config set compaction.mode safeguard
   openclaw config set compaction.reserveTokensFloor 24000 --json
   openclaw config set compaction.memoryFlush.enabled true --json
   openclaw config set compaction.memoryFlush.softThresholdTokens 6000 --json
   openclaw config set compaction.memoryFlush.systemPrompt "Session nearing compaction. Store durable memories now."
   openclaw config set compaction.memoryFlush.prompt "Write any lasting notes to memory/$(date +%Y-%m-%d).md; reply with NO_REPLY if nothing to store."
   ```

6. **Verify** aliases and config:
   ```
   openclaw models aliases list
   openclaw models status
   openclaw models fallbacks list
   ```
  </action>
  <verify>
Run on EC2:
- `openclaw models aliases list` shows haiku, sonnet, opus
- `openclaw models status` shows default=sonnet, fallback=opus
- `cat ~/.openclaw/openclaw.json | python3 -c "import sys,json; d=json.load(sys.stdin); print(d.get('session',{}).get('historyLimit'))"` returns 100
  </verify>
  <done>Three model aliases configured (haiku/sonnet/opus), default model set to Sonnet, Opus as fallback, session.historyLimit=100, compaction safeguard mode enabled with memory flush</done>
</task>

<task type="auto">
  <name>Task 2: Set heartbeat crons to use Haiku model</name>
  <files>/home/ubuntu/.openclaw/cron/jobs.json</files>
  <action>
SSH to 100.72.143.9 and update all heartbeat cron jobs to use the Haiku model (RL-01):

```
openclaw cron edit heartbeat-main-15m --model haiku
openclaw cron edit heartbeat-landos-15m --model haiku
openclaw cron edit heartbeat-rangeos-15m --model haiku
openclaw cron edit heartbeat-ops-15m --model haiku
openclaw cron edit heartbeat-daily-001 --model haiku
```

Also clean up the stale short-ribs-reminder (one-time event from January, next run is in 351 days):
```
openclaw cron rm 32564f8e-5024-40c7-8a0f-eff162252754
```

Verify with:
```
openclaw cron list
```
  </action>
  <verify>
Run on EC2:
- `openclaw cron list` shows all heartbeat jobs
- `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; jobs=json.load(sys.stdin)['jobs']; hbs=[j for j in jobs if 'heartbeat' in j.get('id','')]; print(all(j.get('model')=='haiku' for j in hbs))"` returns True
- short-ribs-reminder no longer in cron list
  </verify>
  <done>All 5 heartbeat crons use Haiku model. Stale short-ribs-reminder removed. Rate limit budget optimized by routing cheap heartbeats to cheapest model.</done>
</task>

</tasks>

<verification>
1. `openclaw models aliases list` shows 3 aliases
2. `openclaw models status` shows default=sonnet, fallback=opus
3. `openclaw models fallbacks list` shows opus
4. All heartbeat crons have model=haiku in jobs.json
5. session.historyLimit=100 in openclaw.json
6. compaction.mode=safeguard in openclaw.json
7. short-ribs-reminder removed
</verification>

<success_criteria>
- RL-01: Heartbeat crons configured with Haiku model
- RL-02: Default model set to Sonnet (briefings/analysis)
- RL-03: Opus available as alias and fallback for complex reasoning
- RL-04: Session history capped at 100 messages with compaction safeguard
</success_criteria>

<output>
After completion, create `.planning/phases/03-daily-briefing-rate-limits/03-01-SUMMARY.md`
</output>
