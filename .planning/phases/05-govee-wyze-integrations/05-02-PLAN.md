---
phase: 05-govee-wyze-integrations
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - /home/ubuntu/.openclaw/cron/jobs.json
  - /home/ubuntu/.openclaw/skills/govee/SKILL.md
  - /home/ubuntu/clawd/agents/main/health.db
autonomous: true

must_haves:
  truths:
    - "Morning briefing includes a Govee section with latest sensor readings"
    - "Bob can parse weight data from Wyze scale notification emails"
    - "Weekly health summary includes weight trend data"
    - "Wyze weight data is stored in health.db for trend analysis"
  artifacts:
    - path: "/home/ubuntu/.openclaw/cron/jobs.json"
      provides: "Updated morning briefing with Govee section, updated weekly review with weight trend"
    - path: "/home/ubuntu/clawd/agents/main/health.db"
      provides: "wyze_weight table for parsed weight data"
  key_links:
    - from: "morning-briefing cron systemEvent"
      to: "Govee API device state"
      via: "agent reads sensors during briefing via SKILL.md"
      pattern: "Govee|temperature|humidity"
    - from: "weekly-review cron systemEvent"
      to: "wyze_weight table"
      via: "agent queries weight trend from health.db"
      pattern: "wyze_weight"
    - from: "Wyze email parsing instructions"
      to: "Gmail integration"
      via: "agent searches emails for Wyze scale subjects"
      pattern: "Wyze.*scale|weigh"
---

<objective>
Integrate Govee sensor data into the morning briefing, set up Wyze scale weight parsing from Gmail, and add weight trends to the weekly health summary.

Purpose: Complete the data loop — Govee readings appear in daily briefings, Wyze weight data is captured from email notifications, and weekly reviews include weight trends alongside Oura health data.

Output: Updated morning briefing cron with Govee section, wyze_weight SQLite table, Wyze email parsing instructions in Govee skill (or new skill section), updated weekly review with weight trend.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-govee-wyze-integrations/05-01-SUMMARY.md
@.planning/phases/03-daily-briefing-rate-limits/03-02-SUMMARY.md
@.planning/phases/03-daily-briefing-rate-limits/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Govee section to morning briefing and create wyze_weight table</name>
  <files>/home/ubuntu/.openclaw/cron/jobs.json, /home/ubuntu/clawd/agents/main/health.db</files>
  <action>
SSH to EC2 (ssh -i ~/.ssh/clawdbot-key.pem ubuntu@100.72.143.9).

1. **Create wyze_weight table in existing health.db**:
   ssh ... "sqlite3 /home/ubuntu/clawd/agents/main/health.db 'CREATE TABLE IF NOT EXISTS wyze_weight (
     id INTEGER PRIMARY KEY AUTOINCREMENT,
     date TEXT NOT NULL UNIQUE,
     weight_lbs REAL NOT NULL,
     bmi REAL,
     body_fat_pct REAL,
     muscle_mass_pct REAL,
     source TEXT DEFAULT \"email\",
     created_at TEXT DEFAULT CURRENT_TIMESTAMP
   );
   CREATE INDEX IF NOT EXISTS idx_wyze_date ON wyze_weight(date);'"
   Verify: ssh ... "sqlite3 /home/ubuntu/clawd/agents/main/health.db '.schema wyze_weight'"

2. **Update morning briefing cron** to add Section 6 (Govee):
   First, get the current morning-briefing cron ID:
   ssh ... "/home/ubuntu/.npm-global/bin/openclaw cron list"

   Edit the morning-briefing systemEvent to append a new section after the existing 5 sections.
   Use `openclaw cron edit <id> --system-event "<full updated text>"`.

   The new section 6 to ADD (keep all existing 5 sections intact):

   ## 6. Home Environment (GV-05)
   Use the Govee skill to read current sensor data. For each sensor, call the Govee API device state endpoint.
   Report: room name, temperature (F), humidity (%). Flag any anomaly per SKILL.md thresholds (temp outside 60-85F, humidity outside 30-60%).
   Format:
   - Living Room: 72F, 45% humidity
   - Bedroom: 70F, 42% humidity
   If sensors are offline, note which ones.

   IMPORTANT: The cron edit replaces the entire system-event text. You MUST include all 6 sections (the original 5 from Phase 3 plus the new Govee section). Read the current system-event text first, then append the new section.

3. **Update weekly review cron** to add weight trend section:
   Get the weekly-review cron ID from the cron list.
   Edit the weekly-review systemEvent to add a weight trend section.

   New section to ADD to weekly review:

   ## Weight Trend
   Query /workspace/health.db: SELECT date, weight_lbs, body_fat_pct FROM wyze_weight ORDER BY date DESC LIMIT 7.
   If data exists, report: current weight, 7-day change (+/- lbs), body fat % if available.
   If no data, say "No Wyze scale data recorded this week."

   IMPORTANT: Same as morning briefing — read full current system-event text first, append the new section, then write back the complete text.

4. **Verify** cron updates:
   ssh ... "/home/ubuntu/.npm-global/bin/openclaw cron list"
   Confirm morning-briefing description mentions Govee/environment.
   Confirm weekly-review mentions weight trend.
  </action>
  <verify>
- wyze_weight table exists in health.db with all columns and index
- morning-briefing cron systemEvent contains all 6 sections including "Home Environment" or "Govee"
- weekly-review cron systemEvent contains "Weight Trend" or "wyze_weight" section
- Both crons still have correct schedules (7 AM PT daily, Sunday 8 AM PT)
  </verify>
  <done>
Govee section added as Section 6 of morning briefing. Weight trend section added to weekly review. wyze_weight table created in health.db for Wyze scale data storage.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Wyze email parsing instructions to Govee skill</name>
  <files>/home/ubuntu/.openclaw/skills/govee/SKILL.md</files>
  <action>
SSH to EC2. Append Wyze weight parsing sections to the existing Govee SKILL.md.
This keeps all device-related health data skills in one place (alternative: separate wyze skill, but since it's only 3 requirements and relies on email parsing, not a dedicated API, appending is simpler).

**Append these sections to SKILL.md:**

**Section 10: Wyze Scale — Email Parsing (WY-01, WY-02)**

Bob already has Gmail access. Wyze Scale sends email notifications after weigh-ins with subject lines containing "Wyze" and weight data.

To find Wyze scale emails:
1. Search Gmail for recent Wyze scale notifications:
   - Search query: "from:wyze OR subject:wyze scale" (adjust based on actual sender — could be noreply@wyze.com or similar)
   - Look for emails within the last 7 days
2. Parse the email body for weight data:
   - Weight in lbs (primary measurement)
   - BMI (if included)
   - Body fat percentage (if included)
   - Muscle mass (if included)
   - Date/time of weigh-in
3. Store parsed data:
   sqlite3 /workspace/health.db "INSERT OR REPLACE INTO wyze_weight (date, weight_lbs, bmi, body_fat_pct, muscle_mass_pct, source) VALUES ('<date>', <weight>, <bmi_or_null>, <body_fat_or_null>, <muscle_or_null>, 'email');"

Note: Wyze email format may vary. If Bob can't find weight data in emails, ask Andy to:
- Open the Wyze app -> Scale -> Settings -> Export Data (sends CSV to email)
- Or manually provide the weight for that day

Alternative approach if emails don't work:
- Andy can say "Log my weight: 185.4 lbs" and Bob stores it directly
- Bob should accept manual weight entries in addition to email parsing

**Section 11: Wyze Weight Queries (WY-03)**

Query for weekly trend:
  sqlite3 /workspace/health.db "SELECT date, weight_lbs, body_fat_pct FROM wyze_weight WHERE date >= date('now', '-7 days') ORDER BY date ASC;"

Query for monthly trend:
  sqlite3 /workspace/health.db "SELECT date, weight_lbs FROM wyze_weight WHERE date >= date('now', '-30 days') ORDER BY date ASC;"

Format for weekly summary:
  Weight Trend:
  - Current: {latest_weight} lbs
  - 7-day change: {+/- delta} lbs
  - Body fat: {latest_body_fat}% (if available)
  - Trend: {increasing/decreasing/stable}

Determine trend by comparing first and last readings in the 7-day window.

**Section 12: Combined Health Dashboard**
When asked for a "health summary" or "health dashboard", combine:
1. Oura data (from health_snapshots): sleep, readiness, HRV, activity
2. Govee data (from govee_readings): room temps, humidity
3. Wyze data (from wyze_weight): weight, body composition

Query:
  sqlite3 /workspace/health.db "
    SELECT 'oura' as source, date, sleep_score, readiness_score FROM health_snapshots ORDER BY date DESC LIMIT 1;
    SELECT 'govee' as source, device_name, temperature_f, humidity_pct FROM govee_readings ORDER BY reading_time DESC LIMIT 3;
    SELECT 'wyze' as source, date, weight_lbs, body_fat_pct FROM wyze_weight ORDER BY date DESC LIMIT 1;
  "

Verify the updated skill:
  ssh ... "/home/ubuntu/.npm-global/bin/openclaw skills list" (should still show govee)
  Verify file length increased by checking line count.
  </action>
  <verify>
- SKILL.md contains sections 10, 11, 12 (Wyze email parsing, weight queries, combined dashboard)
- File references /workspace/health.db and wyze_weight table
- "openclaw skills list" still shows govee skill
  </verify>
  <done>
Wyze email parsing, weight query templates, and combined health dashboard instructions appended to Govee SKILL.md. Bob can now parse Wyze emails for weight data, store it, and produce combined health reports.
  </done>
</task>

</tasks>

<verification>
Phase 5 remaining requirements check:
- GV-05: Morning briefing has Govee section (Section 6 with temp/humidity readings)
- WY-01: SKILL.md documents how to search Gmail for Wyze scale emails (Gmail filter via search query)
- WY-02: SKILL.md documents parsing weight data from email body and storing in wyze_weight table
- WY-03: Weekly review cron includes weight trend section querying wyze_weight table
</verification>

<success_criteria>
1. Morning briefing cron contains all 6 sections including Govee home environment
2. Weekly review cron includes weight trend section
3. wyze_weight table exists in health.db
4. SKILL.md has Wyze parsing sections with store-and-query workflows
5. Combined health dashboard query documented
</success_criteria>

<output>
After completion, create `.planning/phases/05-govee-wyze-integrations/05-02-SUMMARY.md`
</output>
