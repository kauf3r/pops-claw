---
phase: 10-agentic-coding-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /home/ubuntu/.openclaw/skills/coding-assistant/SKILL.md
  - /home/ubuntu/.openclaw/cron/jobs.json
autonomous: true

must_haves:
  truths:
    - "Bob knows how to review a PR when asked 'review PR #N' via Slack"
    - "Bob can list open PRs, create issues, and browse code via gh CLI"
    - "Morning briefing includes open PR count for tracked repos"
  artifacts:
    - path: "/home/ubuntu/.openclaw/skills/coding-assistant/SKILL.md"
      provides: "Instructions for PR review, issue management, and code assistance using gh CLI"
    - path: "/home/ubuntu/.openclaw/cron/jobs.json"
      provides: "Updated morning-briefing systemEvent with GitHub open PR section"
  key_links:
    - from: "coding-assistant/SKILL.md"
      to: "gh CLI in sandbox"
      via: "Skill instructs agent to use gh pr view, gh pr diff, gh pr review, gh issue create"
    - from: "cron/jobs.json (morning-briefing)"
      to: "gh CLI"
      via: "systemEvent text instructs agent to run gh pr list for open PR count"
---

<objective>
Create the coding-assistant skill and add open PR count to the morning briefing.

Purpose: Bob can review PRs, create issues, and include GitHub activity in the daily briefing -- all via existing gh CLI already bind-mounted in sandbox.
Output: SKILL.md on EC2 + updated morning-briefing cron job
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-mcp-servers/04-01-SUMMARY.md
@.planning/phases/03-daily-briefing-rate-limits/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create coding-assistant SKILL.md with PR review, issue management, and code assistance</name>
  <files>/home/ubuntu/.openclaw/skills/coding-assistant/SKILL.md</files>
  <action>
SSH to EC2 (100.72.143.9) and create the skill directory and file:

```bash
mkdir -p ~/.openclaw/skills/coding-assistant
```

Write `~/.openclaw/skills/coding-assistant/SKILL.md` with this structure:

**YAML frontmatter (required for OpenClaw skill detection):**
```yaml
---
name: coding-assistant
description: PR review, issue management, and code assistance via GitHub CLI
---
```

**Section 1: Overview**
- This skill enables code review, issue management, and repository browsing
- All commands use `gh` CLI (already available in sandbox at /usr/bin/gh)
- GITHUB_TOKEN is already configured in environment
- Default org/repos to watch: list user's repos via `gh repo list --limit 20`

**Section 2: PR Review Workflow**
When user says "review PR #N" or "review PR #N on owner/repo":

1. **Get PR metadata:**
   ```
   gh pr view N --repo owner/repo --json title,body,author,baseRefName,headRefName,additions,deletions,changedFiles,reviewDecision,labels,comments
   ```

2. **Get the diff:**
   ```
   gh pr diff N --repo owner/repo
   ```

3. **Get existing review comments:**
   ```
   gh pr view N --repo owner/repo --json reviews,comments
   ```

4. **Analyze and respond with:**
   - Summary of what the PR does (1-2 sentences)
   - Files changed with brief description of each change
   - Potential issues: bugs, security concerns, performance, style
   - Suggestions for improvement
   - Overall assessment: approve / request changes / needs discussion

5. **If user wants to post a review:**
   ```
   gh pr review N --repo owner/repo --approve --body "Review text"
   gh pr review N --repo owner/repo --request-changes --body "Review text"
   gh pr review N --repo owner/repo --comment --body "Review text"
   ```

6. **If user wants to add a comment on a specific line, use the GitHub API:**
   ```
   gh api repos/owner/repo/pulls/N/comments -f body="comment" -f commit_id="SHA" -f path="file.py" -F line=42 -f side="RIGHT"
   ```

**Default repo inference:** If user says just "review PR #N" without specifying a repo, check:
- If in a conversation about a specific repo, use that
- Otherwise ask which repo, or check `gh pr list` across repos to find PR #N

**Section 3: Issue Management**

Create issues:
```
gh issue create --repo owner/repo --title "Title" --body "Description" --label "bug"
```

List issues:
```
gh issue list --repo owner/repo --state open --limit 20
```

View issue:
```
gh issue view N --repo owner/repo
```

Close issue:
```
gh issue close N --repo owner/repo --comment "Reason"
```

**Section 4: Repository Browsing**

List repos:
```
gh repo list --limit 20
```

View repo:
```
gh repo view owner/repo
```

Browse files (use gh api for file contents):
```
gh api repos/owner/repo/contents/path/to/file --jq '.content' | base64 --decode
```

Search code:
```
gh search code "query" --repo owner/repo --limit 10
```

**Section 5: PR Listing and Status**

List open PRs across repos:
```
gh pr list --repo owner/repo --state open --json number,title,author,createdAt,reviewDecision
```

Check CI status:
```
gh pr checks N --repo owner/repo
```

**Section 6: Code Suggestions**

When reviewing code or discussing improvements:
- Read the file content via `gh api repos/owner/repo/contents/path`
- Propose changes with context (before/after)
- If user approves, can create a PR with changes via `gh api`

**Section 7: Tracked Repositories**

Default repos to monitor for morning briefing PR counts:
- andykaufman/* (list via `gh repo list andykaufman --limit 30`)

The agent should maintain awareness of which repos have active PRs and mention them when relevant.
  </action>
  <verify>
SSH to EC2 and verify:
1. `ls -la ~/.openclaw/skills/coding-assistant/SKILL.md` -- file exists
2. `wc -l ~/.openclaw/skills/coding-assistant/SKILL.md` -- 100+ lines of meaningful content
3. `head -5 ~/.openclaw/skills/coding-assistant/SKILL.md` -- has YAML frontmatter with name and description
4. `grep -c "gh pr" ~/.openclaw/skills/coding-assistant/SKILL.md` -- multiple gh pr command references
  </verify>
  <done>coding-assistant SKILL.md deployed with PR review workflow, issue management, repo browsing, and code suggestion sections. CW-01 and CW-02 satisfied.</done>
</task>

<task type="auto">
  <name>Task 2: Add open PR count section to morning briefing cron</name>
  <files>/home/ubuntu/.openclaw/cron/jobs.json</files>
  <action>
SSH to EC2 (100.72.143.9) and update the morning-briefing cron job to include a GitHub section.

**Step 1:** Find the morning-briefing cron job ID:
```bash
/home/ubuntu/.npm-global/bin/openclaw cron list | grep morning
```

**Step 2:** Read the current systemEvent text to understand the existing sections:
```bash
cat ~/.openclaw/cron/jobs.json | python3 -c "
import sys, json
jobs = json.load(sys.stdin)
for j in jobs:
    if 'morning' in j.get('name', '').lower():
        print(json.dumps(j['payload'], indent=2))
"
```

**Step 3:** Edit the cron job's systemEvent to append a new GitHub section AFTER the existing sections. The existing briefing has sections for calendar, email, health, weather, and tasks. Add:

Section N (next number after existing sections): **GitHub Activity**
```
## Section N: GitHub Activity
Run `gh pr list --state open --json number,title,repo,author,createdAt --limit 20` to get all open PRs across repos.
- If any open PRs exist, list them with: PR number, repo name, title, author, and age (days since created)
- Format as a compact table or bullet list
- If no open PRs, say "No open PRs"
- Also run `gh pr list --state open --search "review-requested:andykaufman" --json number,title,repo` to highlight PRs where your review is requested
```

Use `openclaw cron edit` with --system-event flag to update the payload. The system-event text must include ALL existing sections plus the new GitHub section (the edit replaces the full systemEvent text).

**Important:** Read the full current systemEvent text first, then append the new section. Do NOT lose any existing sections. The systemEvent text is a single string containing all section instructions.

**Step 4:** Verify the update:
```bash
/home/ubuntu/.npm-global/bin/openclaw cron list | grep morning
```
And inspect jobs.json to confirm the new section is present.
  </action>
  <verify>
SSH to EC2 and verify:
1. `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; jobs=json.load(sys.stdin); [print('GitHub' in j['payload'].get('text','')) for j in jobs if 'morning' in j.get('name','').lower()]"` -- prints True
2. `openclaw cron list` shows morning-briefing still has correct schedule
3. The systemEvent text contains both existing sections AND the new GitHub section
  </verify>
  <done>Morning briefing cron includes GitHub Activity section with open PR count. CW-03 satisfied.</done>
</task>

</tasks>

<verification>
1. coding-assistant SKILL.md exists at ~/.openclaw/skills/coding-assistant/ with frontmatter
2. SKILL.md contains PR review workflow, issue management, repo browsing sections
3. Morning briefing cron job systemEvent includes GitHub Activity section
4. All existing briefing sections preserved (calendar, email, health, weather, tasks)
5. No gateway restart needed yet (skill detection happens on next session)
</verification>

<success_criteria>
- CW-01: coding-assistant SKILL.md created and deployed
- CW-02: Skill combines gh CLI (GitHub MCP), filesystem (code browsing), and structured review workflow
- CW-03: Morning briefing includes open PR count section
- CW-04 readiness: Skill teaches Bob the "review PR #N" workflow (verified in Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/10-agentic-coding-workflow/10-01-SUMMARY.md`
</output>
