---
phase: 14-writing-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - "~/.openclaw/skills/seo-writer/SKILL.md (EC2)"
  - "~/clawd/agents/quill/WRITING_SESSION.md (EC2)"
autonomous: true

must_haves:
  truths:
    - "seo-writer skill is discoverable by all agents via OpenClaw skill loader"
    - "Skill describes complete article writing workflow with topic claiming, SEO structure, content.db writes, and status transitions"
    - "Quill knows how to claim a topic from backlog, write a 1500-2500 word draft, and store it in content.db articles table"
    - "WRITING_SESSION.md reference doc guides Quill through a daily writing session end-to-end"
  artifacts:
    - path: "~/.openclaw/skills/seo-writer/SKILL.md"
      provides: "SEO writing skill with article structure, H2/H3 requirements, UAS voice, content.db INSERT, topic claiming"
      contains: "seo-writer"
    - path: "~/clawd/agents/quill/WRITING_SESSION.md"
      provides: "Daily writing session reference doc with step-by-step instructions for topic selection, drafting, and storage"
      contains: "Writing Session"
  key_links:
    - from: "seo-writer SKILL.md"
      to: "/workspace/content.db"
      via: "SQLite INSERT into articles table + UPDATE topics status"
      pattern: "INSERT INTO articles"
    - from: "seo-writer SKILL.md"
      to: "/workspace/content.db"
      via: "pipeline_activity logging"
      pattern: "INSERT INTO pipeline_activity"
    - from: "seo-writer SKILL.md"
      to: "/workspace/content.db"
      via: "Topic claiming with BEGIN IMMEDIATE"
      pattern: "UPDATE topics SET status = 'writing'"
    - from: "WRITING_SESSION.md"
      to: "seo-writer SKILL.md"
      via: "References skill for article writing workflow"
      pattern: "seo-writer"
---

<objective>
Create the seo-writer skill and WRITING_SESSION.md reference doc for Quill.

Purpose: Quill needs a skill that teaches SEO article writing (H2/H3 structure, 1500-2500 words, UAS voice) and a reference doc that guides daily writing sessions -- claim a topic from backlog, draft the article, store in content.db articles table with status "review".
Output: seo-writer SKILL.md in skills directory + WRITING_SESSION.md in Quill's workspace.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-content-db-agent-setup/12-02-SUMMARY.md
@.planning/phases/13-topic-research/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create seo-writer skill</name>
  <files>~/.openclaw/skills/seo-writer/SKILL.md (EC2)</files>
  <action>
Create `~/.openclaw/skills/seo-writer/` directory and write SKILL.md on EC2.

The skill follows the established SKILL.md pattern (YAML frontmatter with name + description, then structured body). Model after the content-strategy skill (Phase 13-01) but for article writing instead of topic research.

**Frontmatter:**
```yaml
---
name: SEO Content Writer
description: "Write SEO-optimized articles for AirSpace Integration's UAS/drone services blog. Covers article structure, keyword placement, readability, and content.db storage."
---
```

**Skill body sections:**

**1. Overview**
This skill enables SEO-optimized article writing for the AirSpace Integration content marketing pipeline. The writer claims topics from the content.db backlog, writes 1500-2500 word drafts following SEO best practices, and stores completed drafts for editorial review.

**2. Prerequisites**
- `/workspace/content.db` must be accessible (bind-mounted from host)
- `sqlite3` CLI available in sandbox
- Read PRODUCT_CONTEXT.md in your workspace for UAS domain rules before writing
- Browser available for fact-checking and research during writing

**3. Topic Claiming Workflow**

Before writing, claim a topic from the backlog using the claim locking protocol (CP-05):

```sql
BEGIN IMMEDIATE;

UPDATE topics
SET status = 'writing', claimed_by = 'quill', claimed_at = CURRENT_TIMESTAMP
WHERE id = <topic_id>
  AND status = 'backlog'
  AND claimed_by IS NULL;

-- Verify exactly 1 row was updated (claim succeeded)
-- If 0 rows: topic was already claimed by another agent, pick a different one

INSERT INTO pipeline_activity (entity_type, entity_id, agent_id, action, old_status, new_status, details)
VALUES ('topics', <topic_id>, 'quill', 'claimed', 'backlog', 'writing', 'Claimed for article writing');

COMMIT;
```

**Selection priority:**
1. Pick highest priority (lowest number) topic first
2. Among same priority, pick oldest (earliest created_at)
3. Query: `SELECT id, title, brief, keywords, content_type, priority, source_url FROM topics WHERE status = 'backlog' AND claimed_by IS NULL ORDER BY priority ASC, created_at ASC LIMIT 5;`

**4. Article Structure Requirements**

Every article must follow this structure:

```
# Title (H1) — Include primary keyword, 50-70 characters

## Introduction (H2)
- Hook the reader in first 2 sentences
- State the problem or opportunity
- Preview what the article covers
- 100-200 words

## [Main Section 1] (H2) — Include keyword variant
### [Subsection 1a] (H3) — Optional, for complex sections
### [Subsection 1b] (H3)
- 300-500 words per H2 section
- Each H2 should cover one distinct subtopic

## [Main Section 2] (H2)
### [Subsection 2a] (H3)
- Continue with 3-5 H2 sections total

## Key Takeaways / Conclusion (H2)
- Summarize main points (3-5 bullet points)
- Include call-to-action relevant to UAS services
- 100-200 words
```

**5. SEO Writing Rules**

Content rules:
- **Word count:** 1500-2500 words (measure with character count / 5 approximation)
- **Primary keyword:** Use in H1, first paragraph, 1-2 H2 headings, and conclusion
- **Keyword density:** 1-2% (approximately every 50-100 words naturally)
- **Secondary keywords:** Use 3-5 related keywords throughout the body
- **H2 sections:** 3-5 per article, each with descriptive keyword-rich headings
- **H3 subsections:** Optional, use when an H2 section covers 400+ words
- **Paragraphs:** 2-4 sentences each (short, scannable)
- **Lists:** Use bulleted or numbered lists at least 2-3 times per article
- **Internal linking opportunities:** Note where future articles could link (use `[INTERNAL_LINK: topic]` placeholder)
- **Meta description:** Write a 150-160 character summary for SEO (stored in articles table)

**6. UAS Voice and Tone**

Follow PRODUCT_CONTEXT.md DO/DON'T rules. Additionally:

Voice:
- Professional but approachable — not academic, not casual
- Authoritative on commercial drone operations
- Solution-oriented (focus on how drones solve real problems)
- Data-driven when possible (cite statistics, case studies, ROI figures)

Tone guidelines:
- Write for drone service operators and potential clients, not hobbyists
- Assume reader has basic drone awareness but may not know commercial applications
- Avoid jargon without explanation (define terms like BVLOS, RTK, Part 107 on first use)
- Use active voice, concrete examples
- No marketing fluff — provide genuine value

**7. Writing Process**

Step 1 - Review the topic brief:
- Read the topic's brief, keywords, and source_url from content.db
- Research the topic further if needed (use browser)
- Create a mental outline mapping to the H2 structure

Step 2 - Draft the article:
- Write following the structure in Section 4
- Hit all SEO requirements in Section 5
- Maintain UAS voice from Section 6
- Include relevant data, examples, or case studies

Step 3 - Self-review checklist:
- [ ] Word count is 1500-2500
- [ ] H1 includes primary keyword
- [ ] 3-5 H2 sections with keyword variants
- [ ] Meta description written (150-160 chars)
- [ ] No PRODUCT_CONTEXT.md DON'T violations
- [ ] Paragraphs are 2-4 sentences
- [ ] At least 2 bullet/numbered lists used
- [ ] Conclusion includes call-to-action
- [ ] All facts are verifiable (no hallucinated statistics)

Step 4 - Generate slug:
- Lowercase, hyphen-separated, derived from title
- Example: "lidar-drones-construction-site-surveys"
- Max 60 characters

**8. Storing the Draft**

After writing, insert the article into content.db:

```sql
BEGIN IMMEDIATE;

INSERT INTO articles (topic_id, title, body, meta_description, slug, word_count, status, claimed_by, claimed_at)
VALUES (
  <topic_id>,
  '<article title>',
  '<full article body in markdown>',
  '<150-160 char meta description>',
  '<url-slug>',
  <word_count_integer>,
  'review',
  'quill',
  CURRENT_TIMESTAMP
);

-- Update topic status to reflect writing is complete
UPDATE topics SET status = 'writing', updated_at = CURRENT_TIMESTAMP WHERE id = <topic_id>;

-- Log activity (CP-06)
INSERT INTO pipeline_activity (entity_type, entity_id, agent_id, action, old_status, new_status, details)
VALUES ('articles', last_insert_rowid(), 'quill', 'drafted', 'writing', 'review', 'Draft complete, ready for editorial review');

COMMIT;
```

**Note on body field:** The article body should be stored as Markdown text. Escape single quotes in the SQL by doubling them (`''`). For very long articles, use the sqlite3 CLI's `.parameter` or heredoc patterns to avoid shell escaping issues.

**9. Error Handling**
- If content.db is locked (SQLITE_BUSY), retry after 2 seconds, max 3 retries
- If topic was already claimed (0 rows updated), pick next topic from backlog
- If no topics in backlog, post to #content-pipeline: "No topics available in backlog. Waiting for next research cycle."
- If research sources are unavailable, write from domain knowledge and PRODUCT_CONTEXT.md
- Always validate against PRODUCT_CONTEXT.md rules before storing

**10. Tips**
- Read 2-3 of the topic's source_urls before writing (if provided)
- Cross-reference keywords with the topic brief to stay on target
- Think about what a commercial drone operator would find valuable
- Link sections back to AirSpace Integration's service capabilities where natural
- Seasonal awareness: construction peaks spring/summer, agriculture varies by crop cycle
- Avoid writing on topics that overlap heavily with existing articles: `SELECT title, slug FROM articles ORDER BY created_at DESC LIMIT 10;`

Verify skill is detected by restarting gateway and checking skills output.
  </action>
  <verify>
SSH to EC2 and confirm:
1. `ls ~/.openclaw/skills/seo-writer/SKILL.md` — file exists
2. `head -5 ~/.openclaw/skills/seo-writer/SKILL.md` — has correct frontmatter (name: SEO Content Writer)
3. `grep -c "INSERT INTO articles" ~/.openclaw/skills/seo-writer/SKILL.md` — returns at least 1
4. `grep -c "BEGIN IMMEDIATE" ~/.openclaw/skills/seo-writer/SKILL.md` — returns at least 2 (claim + store)
5. `grep -c "PRODUCT_CONTEXT" ~/.openclaw/skills/seo-writer/SKILL.md` — returns at least 1
6. Restart gateway: `systemctl --user restart openclaw-gateway`
7. Check gateway loaded skill: `journalctl --user -u openclaw-gateway -n 50 --no-pager | grep -i "seo-writer"` or check skill count in startup logs
  </verify>
  <done>seo-writer SKILL.md deployed at ~/.openclaw/skills/seo-writer/SKILL.md with complete article writing workflow, SEO structure requirements, topic claiming, content.db INSERT, and activity logging</done>
</task>

<task type="auto">
  <name>Task 2: Create WRITING_SESSION.md reference doc in Quill's workspace</name>
  <files>~/clawd/agents/quill/WRITING_SESSION.md (EC2)</files>
  <action>
Create a reference document at `~/clawd/agents/quill/WRITING_SESSION.md` on EC2 that the cron-triggered agent will read and follow.

This follows the established reference doc pattern (TOPIC_RESEARCH.md for rangeos, MEETING_PREP.md, STANDUP.md, etc.).

**CRITICAL:** This runs in sandbox (Docker), NOT embedded mode. Quill's cron uses `sessionTarget: "quill"` with `kind: "agentTurn"`, which runs in Docker sandbox. Use `/workspace/` paths for content.db, NOT host paths.

**Content for WRITING_SESSION.md:**

```markdown
# Writing Session

You are Quill, the SEO content writer for AirSpace Integration's content marketing pipeline. This document guides your daily writing session.

## Before You Start

1. Read your PRODUCT_CONTEXT.md for UAS domain rules (DO/DON'T list)
2. Check if there are topics ready for writing:

```sql
SELECT id, title, brief, keywords, priority, source_url
FROM topics
WHERE status = 'backlog' AND claimed_by IS NULL
ORDER BY priority ASC, created_at ASC
LIMIT 5;
```

If no topics are available (0 rows), post to #content-pipeline: "No topics in backlog. Waiting for next research cycle." and stop.

3. Check if you already have a topic in progress:

```sql
SELECT t.id, t.title, t.brief, t.keywords
FROM topics t
WHERE t.status = 'writing' AND t.claimed_by = 'quill';
```

If you have a topic in progress, continue writing that one instead of claiming a new one.

4. Check your recent output (avoid writing fatigue on similar topics):

```sql
SELECT a.title, a.created_at FROM articles a WHERE a.claimed_by = 'quill' ORDER BY a.created_at DESC LIMIT 5;
```

## Writing Process

Use the seo-writer skill for your complete writing workflow. Key steps:

### Step 1: Claim a Topic

If you don't have one in progress, claim the highest-priority backlog topic:

```sql
BEGIN IMMEDIATE;

UPDATE topics
SET status = 'writing', claimed_by = 'quill', claimed_at = CURRENT_TIMESTAMP
WHERE id = <chosen_topic_id>
  AND status = 'backlog'
  AND claimed_by IS NULL;

INSERT INTO pipeline_activity (entity_type, entity_id, agent_id, action, old_status, new_status, details)
VALUES ('topics', <chosen_topic_id>, 'quill', 'claimed', 'backlog', 'writing', 'Claimed for article writing');

COMMIT;
```

Database path: `/workspace/content.db`

If 0 rows updated, the topic was claimed by someone else. Try the next one.

### Step 2: Research the Topic

- Read the topic brief and keywords from content.db
- If source_url is provided, visit it with browser for context
- Do additional web research if needed to gather facts, statistics, case studies
- Note key data points for the article

### Step 3: Write the Article

Follow the seo-writer skill structure:
- H1 title with primary keyword (50-70 chars)
- Introduction (100-200 words, hook + problem + preview)
- 3-5 H2 sections (300-500 words each, keyword variants in headings)
- H3 subsections for complex sections
- Key Takeaways / Conclusion (100-200 words, call-to-action)
- Total: 1500-2500 words

SEO checklist:
- [ ] Primary keyword in H1, first paragraph, 1-2 H2s, conclusion
- [ ] 3-5 secondary keywords used naturally
- [ ] Short paragraphs (2-4 sentences)
- [ ] At least 2 bullet/numbered lists
- [ ] Meta description (150-160 chars)
- [ ] No PRODUCT_CONTEXT.md DON'T violations
- [ ] All facts verifiable (no hallucinated stats)

### Step 4: Store the Draft

```sql
BEGIN IMMEDIATE;

INSERT INTO articles (topic_id, title, body, meta_description, slug, word_count, status, claimed_by, claimed_at)
VALUES (
  <topic_id>,
  '<article title>',
  '<full article body in markdown>',
  '<150-160 char meta description>',
  '<url-slug>',
  <approximate_word_count>,
  'review',
  'quill',
  CURRENT_TIMESTAMP
);

UPDATE topics SET status = 'writing', updated_at = CURRENT_TIMESTAMP WHERE id = <topic_id>;

INSERT INTO pipeline_activity (entity_type, entity_id, agent_id, action, old_status, new_status, details)
VALUES ('articles', last_insert_rowid(), 'quill', 'drafted', 'writing', 'review', 'Draft complete, ready for editorial review');

COMMIT;
```

Database path: `/workspace/content.db`

### Step 5: Session Summary

Post your writing summary to #content-pipeline with:
- Article title and topic ID
- Word count
- Brief description of what was covered
- Any research notes or concerns for the editor

```sql
SELECT a.id, a.title, a.word_count, a.status, a.created_at
FROM articles a
WHERE a.claimed_by = 'quill' AND a.created_at > datetime('now', '-2 hours')
ORDER BY a.created_at DESC;
```

## Target Output

- 1 article per session (quality over quantity)
- 1500-2500 words
- Status set to 'review' for Sage to pick up

## Error Handling

- If content.db is locked: retry after 2 seconds, max 3 retries
- If topic claim fails (0 rows): try next backlog topic
- If no topics available: post to #content-pipeline and stop
- If research sources unavailable: write from domain knowledge
- Always validate against PRODUCT_CONTEXT.md before storing
- For very long article body SQL, use sqlite3 `.read` with a temp file or careful escaping
```

Write this file via SSH to the EC2 instance.
  </action>
  <verify>
SSH to EC2 and confirm:
1. `ls -la ~/clawd/agents/quill/WRITING_SESSION.md` — file exists
2. `head -3 ~/clawd/agents/quill/WRITING_SESSION.md` — starts with "# Writing Session"
3. `grep -c "INSERT INTO articles" ~/clawd/agents/quill/WRITING_SESSION.md` — returns at least 1
4. `grep -c "/workspace/content.db" ~/clawd/agents/quill/WRITING_SESSION.md` — returns at least 1 (sandbox paths)
5. `grep -c "BEGIN IMMEDIATE" ~/clawd/agents/quill/WRITING_SESSION.md` — returns at least 2 (claim + store)
6. `grep -c "seo-writer" ~/clawd/agents/quill/WRITING_SESSION.md` — returns at least 1 (references the skill)
  </verify>
  <done>WRITING_SESSION.md deployed to Quill workspace with complete daily writing session instructions, topic claiming, article drafting, content.db storage, and session summary</done>
</task>

</tasks>

<verification>
After both tasks:
1. `ls ~/.openclaw/skills/seo-writer/SKILL.md` — skill file exists
2. `ls ~/clawd/agents/quill/WRITING_SESSION.md` — reference doc exists
3. Gateway service is active after restart
4. All 7 agents still loading (check gateway startup logs for agent count)
5. seo-writer skill shows as "ready" in skills list
</verification>

<success_criteria>
- seo-writer SKILL.md created with YAML frontmatter, article structure requirements, SEO rules, UAS voice, topic claiming, content.db INSERT, and activity logging
- WRITING_SESSION.md deployed to Quill workspace with daily session workflow using /workspace/ sandbox paths
- Gateway restarts cleanly with new skill detected
- All 7 agents (main, landos, rangeos, ops, quill, sage, ezra) remain operational
</success_criteria>

<output>
After completion, create `.planning/phases/14-writing-pipeline/14-01-SUMMARY.md`
</output>
