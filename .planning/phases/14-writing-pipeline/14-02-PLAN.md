---
phase: 14-writing-pipeline
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - "~/.openclaw/cron/jobs.json (EC2)"
autonomous: true

must_haves:
  truths:
    - "Writing-check cron fires daily at 11 AM PT targeting Quill"
    - "Cron-triggered writing session produces 1 article draft in content.db with status 'review'"
    - "Quill reads WRITING_SESSION.md reference doc and follows its instructions"
  artifacts:
    - path: "~/.openclaw/cron/jobs.json"
      provides: "writing-check cron entry targeting quill, daily schedule at 11 AM PT"
      contains: "writing-check"
  key_links:
    - from: "cron job (writing-check)"
      to: "WRITING_SESSION.md"
      via: "agentTurn message instructs reading the reference doc"
      pattern: "WRITING_SESSION.md"
    - from: "WRITING_SESSION.md"
      to: "seo-writer SKILL.md"
      via: "References skill for article writing workflow"
      pattern: "seo-writer"
    - from: "WRITING_SESSION.md"
      to: "/workspace/content.db"
      via: "SQLite INSERT into articles + UPDATE topics + pipeline_activity"
      pattern: "INSERT INTO articles"
---

<objective>
Add the daily writing-check cron job for Quill's writing sessions.

Purpose: Automate daily writing so Quill runs once per day, claims a topic from the backlog, writes a 1500-2500 word SEO article, and stores the draft in content.db for editorial review.
Output: writing-check cron job in jobs.json firing daily at 11 AM PT.
</objective>

<execution_context>
@/Users/andykaufman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andykaufman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-writing-pipeline/14-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add writing-check cron job (daily at 11 AM PT)</name>
  <files>~/.openclaw/cron/jobs.json (EC2)</files>
  <action>
Add a new cron job to `~/.openclaw/cron/jobs.json` on EC2 for daily writing sessions.

**Cron schedule:** Daily at 11:00 AM PT
- `0 11 * * *` with `tz: "America/Los_Angeles"` — fires at 11 AM PT daily, DST-safe
- 11 AM PT is after topic research (10 AM PT Tue/Fri) and morning briefing (7 AM PT)
- 1 hour after research ensures fresh topics are available

**Job configuration:**
The job must use `sessionTarget: "quill"` with `kind: "agentTurn"` (content agents use agentTurn, not systemEvent). This runs in Docker sandbox, not embedded mode.

```json
{
  "id": "writing-check",
  "name": "writing-check",
  "cron": "0 11 * * *",
  "tz": "America/Los_Angeles",
  "enabled": true,
  "sessionTarget": "quill",
  "payload": {
    "kind": "agentTurn",
    "message": "Writing Session: Read /workspace/WRITING_SESSION.md and follow its instructions to claim a topic from the backlog, write an SEO-optimized article, and store the draft in /workspace/content.db. Post your summary to #content-pipeline when done.",
    "model": "sonnet",
    "timeoutSeconds": 600
  }
}
```

**Implementation steps:**
1. SSH to EC2 and read current jobs.json
2. Add the new job entry to the jobs array
3. **Do NOT include a `delivery` key** — per lessons learned, delivery.mode announce only works with sessionTarget "isolated", and quill is a named agent session. If gateway auto-adds delivery on restart, remove it.
4. Write updated jobs.json
5. Restart gateway to load new cron: `systemctl --user restart openclaw-gateway`
6. Verify cron loaded by checking gateway logs
7. If gateway auto-populated delivery config, remove it and restart again

**IMPORTANT notes:**
- Use `sessionTarget: "quill"` (NOT "isolated") — targets Quill's agent session
- Use `kind: "agentTurn"` with `message` field (NOT `kind: "systemEvent"` with `text` field) — required for non-main sessionTarget
- Use `model: "sonnet"` — writing needs reasoning but not opus-level
- Use `timeoutSeconds: 600` (10 min) — article writing + research + DB operations takes more time than topic research
- Path in message is `/workspace/WRITING_SESSION.md` (sandbox path, since agentTurn runs in Docker)
- No `delivery` config — response stays in agent's session
- Use `tz: "America/Los_Angeles"` for DST-safe scheduling (same pattern as topic-research cron)
  </action>
  <verify>
SSH to EC2 and confirm:
1. `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; jobs=json.load(sys.stdin)['jobs']; matches=[j for j in jobs if j.get('id')=='writing-check' or j.get('name')=='writing-check']; print(json.dumps(matches, indent=2))"` — returns the writing-check job
2. Verify cron schedule is `0 11 * * *`
3. Verify `sessionTarget` is `quill`
4. Verify `payload.kind` is `agentTurn`
5. Verify `payload.message` references `WRITING_SESSION.md`
6. Verify `payload.timeoutSeconds` is 600
7. Verify NO `delivery` key exists in the job
8. `systemctl --user is-active openclaw-gateway` — returns "active"
9. Check gateway logs for cron loading: `journalctl --user -u openclaw-gateway -n 30 --no-pager | grep -i "cron\|writing-check"`
10. Count total cron jobs to ensure no regressions: `cat ~/.openclaw/cron/jobs.json | python3 -c "import sys,json; print(len(json.load(sys.stdin)['jobs']))"`
  </verify>
  <done>writing-check cron job added to jobs.json firing daily at 11 AM PT, targeting quill with agentTurn, sonnet model, 10-min timeout, no delivery config</done>
</task>

</tasks>

<verification>
After task completion:
1. Cron job `writing-check` exists in jobs.json with correct config
2. Gateway service active and cron loaded
3. All existing cron jobs continue functioning (no regressions)
4. No delivery config on the job (prevents announce-mode errors)
5. Optional manual trigger test: `openclaw cron run writing-check --timeout 600000`
   - Should read WRITING_SESSION.md, check backlog, claim topic, write article, store in content.db
   - Should post summary to #content-pipeline
</verification>

<success_criteria>
- writing-check cron job in jobs.json: daily at 11 AM PT, sessionTarget quill, agentTurn, sonnet, 600s timeout, no delivery config
- Gateway restarts cleanly with new cron job loaded
- All existing cron jobs continue functioning (no regressions)
- Total cron count increases by 1 from baseline
</success_criteria>

<output>
After completion, create `.planning/phases/14-writing-pipeline/14-02-SUMMARY.md`
</output>
